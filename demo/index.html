<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FuelFlow - Premium Fuel Delivery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dark theme (default) */
            --primary: #0B1426;
            --primary-light: #1E293B;
            --secondary: #FF6B35;
            --secondary-light: #FF8A65;
            --accent: #00D9FF;
            --accent-dark: #0891B2;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-dark: #334155;
            --background: #020617;
            --surface: #1E293B;
            --surface-light: #334155;
            --border: #475569;
            --border-light: #64748B;
            --glass: rgba(248, 250, 252, 0.08);
            --glass-border: rgba(248, 250, 252, 0.12);
            --glass-strong: rgba(30, 41, 59, 0.9);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 35px 60px -12px rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
            --gradient-surface: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%);
        }

        [data-theme="light"] {
            /* Light theme */
            --primary: #1E40AF;
            --primary-light: #3B82F6;
            --secondary: #FF6B35;
            --secondary-light: #FF8A65;
            --accent: #0EA5E9;
            --accent-dark: #0369A1;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-dark: #334155;
            --background: #F8FAFC;
            --surface: #FFFFFF;
            --surface-light: #F1F5F9;
            --border: #E2E8F0;
            --border-light: #CBD5E1;
            --glass: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.08);
            --glass-strong: rgba(255, 255, 255, 0.95);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 35px 60px -12px rgba(0, 0, 0, 0.15);
            --gradient-primary: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
            --gradient-surface: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, var(--primary) 50%, var(--primary-light) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* Enhanced Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 217, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 217, 255, 0.08) 0%, transparent 40%);
            pointer-events: none;
            z-index: -1;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(1deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        /* Enhanced Glass morphism */
        .glass {
            background: var(--glass);
            backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--shadow);
        }

        .glass-strong {
            background: var(--glass-strong);
            backdrop-filter: blur(32px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
        }

        /* Improved Settings Panel */
        .settings-btn {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            color: var(--text-primary);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            backdrop-filter: blur(24px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .settings-btn:hover {
            background: var(--gradient-primary);
            transform: translateY(-2px) scale(1.05);
            color: white;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -420px;
            width: 420px;
            height: 100vh;
            background: var(--glass-strong);
            backdrop-filter: blur(32px);
            border-left: 1px solid var(--glass-border);
            z-index: 1001;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 2rem;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .settings-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Enhanced Login Screen */
        .login-screen, .signup-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background);
            z-index: 999;
            transition: all 0.4s ease;
        }

        .login-screen.hidden, .signup-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .login-box {
            background: var(--glass-strong);
            backdrop-filter: blur(32px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 3rem;
            width: 90%;
            max-width: 480px;
            text-align: center;
            animation: slideInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl);
        }

        .logo {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Enhanced Form Styling */
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 1.2rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1rem;
            backdrop-filter: blur(16px);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* Enhanced Buttons */
        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            width: 100%;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 217, 255, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .btn-outline:hover {
            background: var(--accent);
            color: white;
        }

        /* Subscription Plans */
        .subscription-plans {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .plan-option {
            position: relative;
        }

        .plan-option input[type="radio"] {
            opacity: 0;
            position: absolute;
        }

        .plan-label {
            display: block;
            background: var(--glass);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-option input[type="radio"]:checked + .plan-label {
            border-color: var(--accent);
            background: var(--glass-strong);
            box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
        }

        .plan-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .plan-price {
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .save-badge {
            background: var(--success);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .plan-features {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Photo Upload Areas */
        .photo-upload-area {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--glass);
        }

        .photo-upload-area:hover {
            border-color: var(--accent);
            background: var(--glass-strong);
        }

        .photo-upload-area.dragover {
            border-color: var(--accent);
            background: rgba(0, 217, 255, 0.1);
        }

        .upload-content {
            pointer-events: none;
        }

        .photo-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .photo-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .photo-preview .remove-photo {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .photo-preview .remove-photo:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* Enhanced App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .app-container.active {
            display: block;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem 2rem;
            background: var(--glass-strong);
            border-radius: 24px;
            backdrop-filter: blur(32px);
            box-shadow: var(--shadow);
        }

        .app-logo {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Enhanced Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 2rem;
            align-items: start;
        }

        /* Enhanced Navigation */
        .nav-container {
            background: var(--glass-strong);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(32px);
            box-shadow: var(--shadow);
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-link {
            padding: 1.2rem 2rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-primary);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .nav-link:hover::before, .nav-link.active::before {
            left: 0;
        }

        .nav-link:hover, .nav-link.active {
            color: white;
            transform: translateY(-2px);
            border-color: transparent;
        }

        /* Enhanced Content Sections */
        .content-section {
            background: var(--glass-strong);
            border-radius: 24px;
            padding: 2rem;
            backdrop-filter: blur(32px);
            animation: fadeInUp 0.6s ease;
            box-shadow: var(--shadow);
        }

        .content-section.hidden {
            display: none;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        /* Enhanced Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .stat-card:hover::before {
            opacity: 0.1;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
        }

        /* Enhanced Location Search */
        .location-search {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .location-search::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 20px 20px 0 0;
        }

        .search-input {
            width: 100%;
            padding: 1.2rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
            transform: translateY(-1px);
        }

        .search-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 217, 255, 0.3);
        }

        /* Enhanced Gas Stations List */
        .gas-stations-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 12px;
        }

        .gas-stations-container::-webkit-scrollbar {
            width: 6px;
        }

        .gas-stations-container::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 3px;
        }

        .gas-stations-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .gas-stations-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        .gas-station {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .gas-station::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: -1;
        }

        .gas-station:hover::before {
            left: 0;
            opacity: 0.1;
        }

        .gas-station:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--accent);
        }

        .gas-station.selected {
            border-color: var(--accent);
            background: var(--glass-strong);
        }

        .gas-station.selected::before {
            left: 0;
            opacity: 0.15;
        }

        .station-info {
            flex: 1;
        }

        .station-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.01em;
        }

        .station-details {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .station-rating {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .price-comparison {
            text-align: right;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            min-width: 180px;
        }

        .price-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .price {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .gas-price {
            color: var(--error);
        }

        .our-price {
            color: var(--success);
        }

        .savings {
            color: var(--success);
            font-weight: 700;
            font-size: 1.1rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
            margin-top: 0.5rem;
        }

        /* Enhanced Phone Demo */
        .phone-demo {
            position: sticky;
            top: 2rem;
            background: var(--glass-strong);
            border-radius: 32px;
            padding: 1.5rem;
            backdrop-filter: blur(32px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-xl);
            max-width: 420px;
        }

        .phone-screen {
            background: var(--gradient-surface);
            border-radius: 28px;
            padding: 1.5rem;
            min-height: 600px;
            max-height: 700px;
            position: relative;
            overflow-y: auto;
            border: 8px solid var(--primary);
            box-shadow: 
                0 0 0 2px var(--border),
                0 0 32px rgba(0,0,0,0.4),
                inset 0 0 0 1px var(--glass-border);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--glass-strong);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            backdrop-filter: blur(24px);
            z-index: 10000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast.info {
            border-left: 4px solid var(--accent);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .phone-demo {
                position: static;
                max-width: 420px;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .login-box {
                margin: 1rem;
                padding: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Special loading state for gas stations */
        .loading-stations {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .loading-stations .loading {
            width: 32px;
            height: 32px;
            border-width: 3px;
            margin-bottom: 1rem;
        }

        /* Enhanced quick test buttons */
        .quick-test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .quick-test-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .quick-test-btn:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <!-- Settings Button -->
    <button class="settings-btn" id="settingsBtn">
        <i class="fas fa-cog"></i>
    </button>

    <!-- Settings Panel -->
    <div class="settings-overlay" id="settingsOverlay"></div>
    <div class="settings-panel" id="settingsPanel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2 style="color: var(--text-primary); margin: 0; font-size: 1.5rem; font-weight: 700;">Settings</h2>
            <button id="closeSettingsBtn" style="background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; padding: 0.5rem;">×</button>
        </div>

        <!-- User Location Settings -->
        <div style="margin-bottom: 2rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600;">Your Location</h3>
            <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem;">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="userZipCode" style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Default ZIP Code</label>
                    <input type="text" id="userZipCode" class="form-input" placeholder="Enter your Miami ZIP code (33xxx)" pattern="33[0-9]{3}">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="userAddress" style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Default Address</label>
                    <input type="text" id="userAddress" class="form-input" placeholder="Enter your delivery address">
                </div>
                <button id="saveLocationBtn" style="background: var(--gradient-primary); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; width: 100%;">
                    Save Location
                </button>
            </div>
        </div>

        <!-- Subscription Info -->
        <div style="margin-bottom: 2rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600;">Subscription</h3>
            <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px; padding: 1.5rem;">
                <div id="subscriptionStatus">
                    <div style="color: var(--success); font-weight: 600; margin-bottom: 0.5rem;">✓ Active Subscription</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Monthly Plan - $29.99/month</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Next billing: March 15, 2024</div>
                </div>
                <button id="manageSubscriptionBtn" style="background: transparent; border: 2px solid var(--accent); color: var(--accent); padding: 0.8rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; width: 100%; margin-top: 1rem;">
                    Manage Subscription
                </button>
            </div>
        </div>

        <!-- Appearance Settings -->
        <div style="margin-bottom: 2rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.1rem; font-weight: 600;">Appearance</h3>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px;">
                <div>
                    <div style="color: var(--text-primary); font-weight: 600;">Dark Mode</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Toggle between light and dark themes</div>
                </div>
                <div style="position: relative; width: 56px; height: 28px; background: var(--border); border-radius: 28px; cursor: pointer; transition: all 0.3s ease;" id="themeToggle">
                    <div style="position: absolute; top: 2px; left: 2px; width: 24px; height: 24px; background: white; border-radius: 50%; transition: all 0.3s ease;" id="themeToggleThumb"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="logo">FuelFlow</div>
            <div class="subtitle">Premium fuel delivery to your location</div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-input" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            <button class="btn btn-outline" id="guestBtn">Continue as Guest</button>
            <button class="btn btn-outline" id="signupBtn">Create Account</button>
        </div>
    </div>

    <!-- Signup Screen -->
    <div class="signup-screen hidden" id="signupScreen">
        <div class="login-box">
            <div class="logo">FuelFlow</div>
            <div class="subtitle">Create your account and subscribe to FuelFlow</div>
            <form id="signupForm">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" class="form-input" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" class="form-input" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" class="form-input" placeholder="Create a password" required>
                </div>
                <div class="form-group">
                    <label for="zipCode">Your Miami ZIP Code</label>
                    <input type="text" id="zipCode" class="form-input" placeholder="Enter your ZIP code (33xxx)" pattern="33[0-9]{3}" required>
                </div>
                
                <!-- Subscription Plans -->
                <div class="form-group" style="margin-top: 2rem;">
                    <label style="font-size: 1.1rem; font-weight: 700; color: var(--accent);">Choose Your Subscription Plan</label>
                    <div class="subscription-plans" style="margin-top: 1rem;">
                        <div class="plan-option">
                            <input type="radio" name="subscription" value="monthly" id="monthlyPlan" checked>
                            <label for="monthlyPlan" class="plan-label">
                                <div class="plan-name">Monthly Plan</div>
                                <div class="plan-price">$29.99/month</div>
                                <div class="plan-features">• Unlimited deliveries • Premium support • Same-day delivery</div>
                            </label>
                        </div>
                        <div class="plan-option">
                            <input type="radio" name="subscription" value="annual" id="annualPlan">
                            <label for="annualPlan" class="plan-label">
                                <div class="plan-name">Annual Plan</div>
                                <div class="plan-price">$299.99/year <span class="save-badge">Save $60!</span></div>
                                <div class="plan-features">• Everything in Monthly • 15% fuel discount • Priority scheduling</div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn">Subscribe & Create Account</button>
            </form>
            <button class="btn btn-outline" id="backToLoginBtn">Back to Login</button>
            <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary); text-align: center;">
                FuelFlow is currently available only in Miami-Dade County, FL
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <div class="app-header">
            <div class="app-logo">FuelFlow</div>
            <div class="user-info">
                <span id="userWelcome">Welcome back!</span>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </div>

        <div class="main-layout">
            <div>
                <!-- Navigation -->
                <div class="nav-container">
                    <div class="nav-tabs">
                        <a href="#" class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="#" class="nav-link" data-section="order">
                            <i class="fas fa-shopping-cart"></i> Order Fuel
                        </a>
                        <a href="#" class="nav-link" data-section="admin">
                            <i class="fas fa-cogs"></i> Admin
                        </a>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div class="content-section" id="dashboardSection">
                    <div class="section-title">Dashboard</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">1,247</div>
                            <div class="stat-label">Total Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">$2,849</div>
                            <div class="stat-label">Total Savings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">98.5%</div>
                            <div class="stat-label">Customer Satisfaction</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">24/7</div>
                            <div class="stat-label">Service Available</div>
                        </div>
                    </div>

                    <div class="location-search">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Find Gas Prices Near You</h3>
                        <input type="text" class="search-input" id="priceLocationInput" placeholder="Enter Miami ZIP code (e.g., 33139, 33143, 33101, 33180)">
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem;">
                            <button class="search-btn" id="searchPricesBtn">
                                <span id="searchBtnText">🔍 Search Gas Stations</span>
                            </button>
                            <button class="search-btn" id="clearSearchBtn" style="background: var(--error); max-width: 100px;">
                                Clear
                            </button>
                        </div>
                        <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                            <strong>Quick Miami Tests:</strong> Try different Miami areas to see gas stations!
                        </div>
                        <div class="quick-test-buttons">
                            <button class="quick-test-btn" onclick="testZipCode('33139')">Miami Beach</button>
                            <button class="quick-test-btn" onclick="testZipCode('33143')">Coral Gables</button>
                            <button class="quick-test-btn" onclick="testZipCode('33101')">Downtown</button>
                            <button class="quick-test-btn" onclick="testZipCode('33180')">Aventura</button>
                            <button class="quick-test-btn" onclick="testZipCode('33010')">Hialeah</button>
                            <button class="quick-test-btn" onclick="testZipCode('33157')">Kendall</button>
                        </div>
                    </div>

                    <div class="gas-stations-container">
                        <div id="gasStationsList"></div>
                    </div>
                </div>

                <!-- Order Section -->
                <div class="content-section hidden" id="orderSection">
                    <div class="section-title">Order Fuel</div>
                    
                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;">
                        <div class="form-group">
                            <label for="locationInput">Delivery Location</label>
                            <input type="text" id="locationInput" class="form-input" placeholder="Enter your address or ZIP code">
                        </div>
                        
                        <div class="form-group">
                            <label for="fuelTypeSelect">Fuel Type</label>
                            <select id="fuelTypeSelect" class="form-input">
                                <option value="premium">Premium ($<span id="premiumPrice">3.79</span>/gal)</option>
                                <option value="regular">Regular ($<span id="regularPrice">3.59</span>/gal)</option>
                                <option value="diesel">Diesel ($<span id="dieselPrice">4.12</span>/gal)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="amountSelect">Amount</label>
                            <select id="amountSelect" class="form-input">
                                <option value="10">10 gallons</option>
                                <option value="15" selected>15 gallons</option>
                                <option value="20">20 gallons</option>
                                <option value="25">25 gallons</option>
                            </select>
                        </div>
                        
                        <div style="border-top: 1px solid var(--border); padding-top: 1rem; margin-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Fuel (<span id="gallonAmount">15</span> gallons @ $<span id="fuelPriceDisplay">3.79</span>):</span>
                                <span id="fuelCostDisplay">$56.85</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Delivery Fee:</span>
                                <span id="deliveryFeeDisplay">$4.99</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; color: var(--success); font-weight: 600;">
                                <span>You Save:</span>
                                <span id="savingsDisplay">$3.42</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700; color: var(--accent); border-top: 1px solid var(--border); padding-top: 1rem;">
                                <span>Total:</span>
                                <span id="totalCostDisplay">$61.84</span>
                            </div>
                        </div>
                    </div>

                    <!-- Vehicle Selection -->
                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Vehicle Information</h3>
                        <div class="form-group">
                            <label for="vehicleSelect">Select Your Vehicle</label>
                            <select id="vehicleSelect" class="form-input">
                                <option value="">Choose your vehicle...</option>
                                <option value="sedan">🚗 Sedan (13-16 gallon tank)</option>
                                <option value="suv">🚙 SUV/Crossover (16-22 gallon tank)</option>
                                <option value="truck">🛻 Pickup Truck (20-30 gallon tank)</option>
                                <option value="luxury">🏎️ Luxury Car (16-20 gallon tank)</option>
                                <option value="sports">🏁 Sports Car (12-18 gallon tank)</option>
                                <option value="van">🚐 Van/Minivan (18-25 gallon tank)</option>
                                <option value="other">🚘 Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vehicleDetails">Vehicle Details (Make, Model, Year, Color)</label>
                            <input type="text" id="vehicleDetails" class="form-input" placeholder="e.g., 2020 Honda Accord White">
                        </div>
                        <div class="form-group">
                            <label for="licensePlate">License Plate (Optional)</label>
                            <input type="text" id="licensePlate" class="form-input" placeholder="ABC-1234">
                        </div>
                    </div>

                    <!-- Photo Upload & Instructions -->
                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Vehicle Photos & Instructions</h3>
                        <div class="form-group">
                            <label for="vehiclePhoto">Upload Vehicle Photo</label>
                            <div class="photo-upload-area" id="vehiclePhotoArea">
                                <input type="file" id="vehiclePhoto" accept="image/*" capture="camera" style="display: none;">
                                <div class="upload-content">
                                    <i class="fas fa-camera" style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;"></i>
                                    <div style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">Take Photo of Your Vehicle</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Help our driver identify your car</div>
                                </div>
                            </div>
                            <div id="vehiclePhotoPreview" class="photo-preview hidden"></div>
                        </div>
                        <div class="form-group">
                            <label for="fuelCapPhoto">Upload Fuel Cap Photo (Optional)</label>
                            <div class="photo-upload-area" id="fuelCapPhotoArea">
                                <input type="file" id="fuelCapPhoto" accept="image/*" capture="camera" style="display: none;">
                                <div class="upload-content">
                                    <i class="fas fa-gas-pump" style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;"></i>
                                    <div style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">Photo of Fuel Cap</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Show how to open your fuel door</div>
                                </div>
                            </div>
                            <div id="fuelCapPhotoPreview" class="photo-preview hidden"></div>
                        </div>
                    </div>

                    <!-- Delivery Instructions -->
                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Delivery Instructions</h3>
                        <div class="form-group">
                            <label for="fuelTankInstructions">Fuel Tank Opening Instructions</label>
                            <textarea id="fuelTankInstructions" class="form-input" rows="3" placeholder="e.g., Push button inside driver door, or pull lever next to driver seat, or press directly on fuel door"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="deliveryNotes">Special Delivery Notes</label>
                            <textarea id="deliveryNotes" class="form-input" rows="3" placeholder="e.g., Gate code, parking location, security instructions, preferred contact method"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="contactPreference">Preferred Contact Method</label>
                            <select id="contactPreference" class="form-input">
                                <option value="text">📱 Text Message</option>
                                <option value="call">📞 Phone Call</option>
                                <option value="app">📲 App Notification</option>
                            </select>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Payment Method</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div style="background: var(--glass); border: 2px solid var(--glass-border); border-radius: 20px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease;" class="payment-method selected" data-payment="stripe">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">💳</div>
                                <div style="font-weight: 600; color: var(--text-primary);">Stripe</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Credit/Debit Cards</div>
                            </div>
                            <div style="background: var(--glass); border: 2px solid var(--glass-border); border-radius: 20px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease;" class="payment-method" data-payment="zelle">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">💸</div>
                                <div style="font-weight: 600; color: var(--text-primary);">Zelle</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Bank Transfer</div>
                            </div>
                        </div>
                    </div>

                    <button class="btn" id="orderBtn">
                        <i class="fas fa-shopping-cart"></i> Complete Order
                    </button>
                </div>

                <!-- Admin Section -->
                <div class="content-section hidden" id="adminSection">
                    <div class="section-title">Admin Panel</div>
                    
                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Price Management</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                            <div style="background: var(--glass); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--glass-border);">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 600;">Premium Price ($/gal)</label>
                                <input type="number" id="premiumPriceInput" step="0.01" value="3.79" style="width: 100%; padding: 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary); font-size: 1.1rem; font-weight: 600;">
                            </div>
                            <div style="background: var(--glass); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--glass-border);">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 600;">Regular Price ($/gal)</label>
                                <input type="number" id="regularPriceInput" step="0.01" value="3.59" style="width: 100%; padding: 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary); font-size: 1.1rem; font-weight: 600;">
                            </div>
                            <div style="background: var(--glass); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--glass-border);">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 600;">Diesel Price ($/gal)</label>
                                <input type="number" id="dieselPriceInput" step="0.01" value="4.12" style="width: 100%; padding: 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary); font-size: 1.1rem; font-weight: 600;">
                            </div>
                            <div style="background: var(--glass); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--glass-border);">
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 600;">Delivery Fee ($)</label>
                                <input type="number" id="deliveryFeeInput" step="0.01" value="4.99" style="width: 100%; padding: 1rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary); font-size: 1.1rem; font-weight: 600;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button style="background: var(--gradient-primary); color: white; border: none; padding: 1rem 2rem; border-radius: 16px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; flex: 1;" id="updatePricesBtn">Update Prices</button>
                            <button style="background: linear-gradient(135deg, var(--success), var(--accent)); color: white; border: none; padding: 1rem 2rem; border-radius: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" id="savePricesBtn">Save Changes</button>
                        </div>
                    </div>

                    <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 20px; padding: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 700;">Live Gas Station Prices</h3>
                        <div id="adminGasStationsList"></div>
                    </div>
                </div>
            </div>

            <!-- Phone Demo -->
            <div class="phone-demo">
                <div class="phone-screen">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                        <div style="font-size: 1.5rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">FuelFlow</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">📱 Live Demo</div>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.1rem; font-weight: 700;">Find Gas Prices</h3>
                        <input type="text" id="mobileLocationInput" placeholder="Enter any ZIP code" style="width: 100%; padding: 0.8rem; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text-primary); font-size: 0.9rem; margin-bottom: 1rem;">
                        <button id="mobileSearchBtn" style="background: var(--gradient-primary); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; width: 100%;">
                            <span id="mobileSearchBtnText">Find Gas Prices</span>
                        </button>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.1rem; font-weight: 700;">Price Comparison</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 12px; padding: 1rem; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent); margin-bottom: 0.5rem;">$<span id="mobileTotalDisplay">61.84</span></div>
                                <div style="color: var(--text-secondary); font-size: 0.8rem;">Total Cost</div>
                            </div>
                            <div style="background: var(--glass); border: 1px solid var(--glass-border); border-radius: 12px; padding: 1rem; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--success); margin-bottom: 0.5rem;">$<span id="mobileSavingsDisplay">3.42</span></div>
                                <div style="color: var(--text-secondary); font-size: 0.8rem;">You Save</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.1rem; font-weight: 700;">Nearby Stations</h3>
                        <div id="mobileStationsContainer">
                            <div style="background: var(--glass); border: 1px solid var(--accent); border-radius: 12px; padding: 1rem; margin-bottom: 0.8rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.3rem;">🛡️ Shell</div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary);">0.5 mi • Biscayne Blvd</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--error); font-weight: 600;">$4.04</div>
                                        <div style="color: var(--success); font-size: 0.8rem;">Save $0.25</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="background: var(--glass); border-radius: 16px; padding: 1.5rem; text-align: center; margin-top: 1rem;">
                        <div style="color: var(--success); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">$<span class="mobile-our-price">3.79</span></div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Our Price/Gallon</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let currentUser = null;
        let isAdmin = false;
        let activeSection = 'dashboard';
        let currentPrices = {
            premium: 3.79,
            regular: 3.59,
            diesel: 4.12,
            deliveryFee: 4.99
        };
        let selectedPayment = 'stripe';
        let currentGasStations = [];
        let lastSearchLocation = '';

        // Initialize App
        function init() {
            showLoginScreen();
            setupEventListeners();
            setupNavigation();
            setupPaymentMethods();
            setupSettingsPanel();
            setupPhotoUpload();
            updatePricing();
            loadUserSettings();
            // Load default gas stations for Miami Beach
            loadDefaultGasStations();
        }

        // Load user settings from localStorage
        function loadUserSettings() {
            const savedZipCode = localStorage.getItem('userZipCode');
            const savedAddress = localStorage.getItem('userAddress');
            
            if (savedZipCode) {
                document.getElementById('userZipCode').value = savedZipCode;
                document.getElementById('locationInput').value = savedAddress || savedZipCode;
            }
            
            if (savedAddress) {
                document.getElementById('userAddress').value = savedAddress;
            }
        }

        function setupEventListeners() {
            // Login and navigation
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('guestBtn').addEventListener('click', () => loginAsGuest());
            document.getElementById('signupBtn').addEventListener('click', () => showSignupScreen());
            document.getElementById('backToLoginBtn').addEventListener('click', () => showLoginScreen());
            document.getElementById('logoutBtn').addEventListener('click', () => logout());
            
            // Order functionality
            document.getElementById('orderBtn').addEventListener('click', handleOrder);
            document.getElementById('locationInput').addEventListener('input', updatePricing);
            document.getElementById('fuelTypeSelect').addEventListener('change', updatePricing);
            document.getElementById('amountSelect').addEventListener('change', updatePricing);

            // Search functionality
            document.getElementById('searchPricesBtn').addEventListener('click', searchPrices);
            document.getElementById('mobileSearchBtn').addEventListener('click', searchMobilePrices);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);

            // Admin functionality
            document.getElementById('updatePricesBtn').addEventListener('click', updateAdminPrices);
            document.getElementById('savePricesBtn').addEventListener('click', saveAdminPrices);
        }

        function setupSettingsPanel() {
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsPanel = document.getElementById('settingsPanel');
            const settingsOverlay = document.getElementById('settingsOverlay');
            const themeToggle = document.getElementById('themeToggle');
            const themeToggleThumb = document.getElementById('themeToggleThumb');

            settingsBtn.addEventListener('click', () => {
                settingsPanel.classList.add('active');
                settingsOverlay.classList.add('active');
            });

            document.getElementById('closeSettingsBtn').addEventListener('click', closeSettings);
            settingsOverlay.addEventListener('click', closeSettings);

            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                
                if (newTheme === 'light') {
                    themeToggle.style.background = 'var(--accent)';
                    themeToggleThumb.style.transform = 'translateX(28px)';
                } else {
                    themeToggle.style.background = 'var(--border)';
                    themeToggleThumb.style.transform = 'translateX(0)';
                }
                
                showToast(`Switched to ${newTheme} mode`, 'success');
            });

            // Location settings
            document.getElementById('saveLocationBtn').addEventListener('click', saveUserLocation);
            
            // Subscription management
            document.getElementById('manageSubscriptionBtn').addEventListener('click', () => {
                showToast('Subscription management will open in a new window', 'info');
            });

            function closeSettings() {
                settingsPanel.classList.remove('active');
                settingsOverlay.classList.remove('active');
            }
        }

        // Save user location settings
        function saveUserLocation() {
            const zipCode = document.getElementById('userZipCode').value.trim();
            const address = document.getElementById('userAddress').value.trim();
            
            if (!zipCode.match(/^33[0-9]{3}$/)) {
                showToast('Please enter a valid Miami ZIP code (33xxx)', 'error');
                return;
            }
            
            // Save to localStorage (in real app, would save to server)
            localStorage.setItem('userZipCode', zipCode);
            localStorage.setItem('userAddress', address);
            
            // Auto-fill order form
            document.getElementById('locationInput').value = address || zipCode;
            
            showToast('Location saved successfully!', 'success');
        }

        // Photo upload functionality
        function setupPhotoUpload() {
            setupPhotoUploadArea('vehiclePhotoArea', 'vehiclePhoto', 'vehiclePhotoPreview');
            setupPhotoUploadArea('fuelCapPhotoArea', 'fuelCapPhoto', 'fuelCapPhotoPreview');
        }

        function setupPhotoUploadArea(areaId, inputId, previewId) {
            const area = document.getElementById(areaId);
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            area.addEventListener('click', () => input.click());
            
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('dragover');
            });
            
            area.addEventListener('dragleave', () => {
                area.classList.remove('dragover');
            });
            
            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handlePhotoUpload(files[0], preview);
                }
            });
            
            input.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handlePhotoUpload(e.target.files[0], preview);
                }
            });
        }

        function handlePhotoUpload(file, preview) {
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="Uploaded photo">
                    <button class="remove-photo" onclick="removePhoto('${preview.id}')">Remove Photo</button>
                `;
                preview.classList.remove('hidden');
                showToast('Photo uploaded successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function removePhoto(previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            preview.classList.add('hidden');
            
            // Clear the input
            const inputId = previewId.replace('Preview', '');
            document.getElementById(inputId).value = '';
            
            showToast('Photo removed', 'info');
        }

        // Check subscription status (demo function)
        function checkSubscriptionStatus() {
            // In real app, would check with server
            return localStorage.getItem('subscriptionActive') === 'true';
        }

        // Validate subscription before allowing certain actions
        function requireSubscription(action) {
            if (!checkSubscriptionStatus()) {
                showToast('This feature requires an active subscription. Please sign up!', 'error');
                document.getElementById('signupBtn').click();
                return false;
            }
            return true;
        }

        // Universal Gas Station Finder - Works with ANY US ZIP Code
        async function findGasStationsForZipCode(zipCode) {
            try {
                console.log(`🔍 Searching for gas stations in ZIP code: ${zipCode}`);
                
                // Step 1: Convert ZIP code to coordinates
                const coordinates = await getCoordinatesFromZipCode(zipCode);
                if (!coordinates) {
                    throw new Error('Could not find coordinates for ZIP code');
                }
                
                console.log(`📍 Found coordinates: ${coordinates.lat}, ${coordinates.lng} for ${zipCode}`);
                
                // Step 2: Find gas stations near coordinates
                const gasStations = await findGasStationsNearCoordinates(coordinates.lat, coordinates.lng, zipCode);
                
                console.log(`⛽ Found ${gasStations.length} gas stations near ${zipCode}`);
                return gasStations;
                
            } catch (error) {
                console.error('Error finding gas stations:', error);
                return [];
            }
        }

        // Convert ZIP code to GPS coordinates
        async function getCoordinatesFromZipCode(zipCode) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Comprehensive Miami-Dade County ZIP code database
            const miamiZipCodeDatabase = {
                // Miami-Dade County ZIP codes with precise coordinates
                '33101': { lat: 25.7617, lng: -80.1918, city: 'Miami Beach, FL' },
                '33102': { lat: 25.7753, lng: -80.1947, city: 'Miami Beach, FL' },
                '33109': { lat: 25.8756, lng: -80.1253, city: 'Bay Harbor Islands, FL' },
                '33114': { lat: 25.8443, lng: -80.1430, city: 'Surfside, FL' },
                '33119': { lat: 25.8398, lng: -80.1253, city: 'Bal Harbour, FL' },
                '33122': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33125': { lat: 25.7676, lng: -80.2429, city: 'Miami, FL' },
                '33126': { lat: 25.7843, lng: -80.2382, city: 'Miami, FL' },
                '33127': { lat: 25.7825, lng: -80.2178, city: 'Miami, FL' },
                '33128': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33129': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33130': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33131': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33132': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33133': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33134': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33135': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33136': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33137': { lat: 25.8398, lng: -80.1253, city: 'Miami Beach, FL' },
                '33138': { lat: 25.8756, lng: -80.1253, city: 'Miami Beach, FL' },
                '33139': { lat: 25.7907, lng: -80.1300, city: 'Miami Beach, FL' },
                '33140': { lat: 25.7907, lng: -80.1300, city: 'Miami Beach, FL' },
                '33141': { lat: 25.8756, lng: -80.1253, city: 'Miami Beach, FL' },
                '33142': { lat: 25.8138, lng: -80.2310, city: 'Miami, FL' },
                '33143': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33144': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33145': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33146': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33147': { lat: 25.8426, lng: -80.2130, city: 'Miami, FL' },
                '33149': { lat: 25.7907, lng: -80.1300, city: 'Miami Beach, FL' },
                '33150': { lat: 25.8756, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33154': { lat: 25.8756, lng: -80.1253, city: 'Bal Harbour, FL' },
                '33155': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33156': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33157': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33158': { lat: 25.9398, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33160': { lat: 25.9398, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33161': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33162': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33163': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33164': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33165': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33166': { lat: 25.8138, lng: -80.2310, city: 'Miami Lakes, FL' },
                '33167': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33168': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33169': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33170': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33172': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33173': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33174': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33175': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33176': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33177': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33178': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33179': { lat: 25.9398, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33180': { lat: 25.9398, lng: -80.1253, city: 'Aventura, FL' },
                '33181': { lat: 25.9398, lng: -80.1253, city: 'Aventura, FL' },
                '33182': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33183': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33184': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33185': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33186': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33187': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33188': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33189': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33190': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33193': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33194': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33195': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33196': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33197': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33199': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33231': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33233': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33234': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33238': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33239': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33242': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33243': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33245': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33247': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33283': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33296': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                // Homestead and South Miami-Dade
                '33030': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33031': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33032': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33033': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33034': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33035': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                // Coral Gables
                '33124': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                '33134': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                '33146': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                '33156': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                // Hialeah
                '33010': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33011': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33012': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33013': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33014': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33015': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33016': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33017': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33018': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                // Key Biscayne
                '33149': { lat: 25.6919, lng: -80.1619, city: 'Key Biscayne, FL' },
                // North Miami
                '33161': { lat: 25.8901, lng: -80.1868, city: 'North Miami, FL' },
                '33162': { lat: 25.8901, lng: -80.1868, city: 'North Miami, FL' },
                '33181': { lat: 25.8901, lng: -80.1868, city: 'North Miami, FL' },
            };
            
            // Check if ZIP code is in Miami-Dade County
            if (miamiZipCodeDatabase[zipCode]) {
                return miamiZipCodeDatabase[zipCode];
            }
            
            // If ZIP code is not in Miami-Dade County, show error
            const firstTwoDigits = parseInt(zipCode.substring(0, 2));
            if (firstTwoDigits !== 33) {
                throw new Error('FuelFlow is currently only available in Miami-Dade County, FL. Please enter a Miami ZIP code (33xxx).');
            }
            
            // For unknown Miami ZIP codes, generate realistic coordinates in Miami area
            return generateMiamiCoordinatesFromZipPattern(zipCode);
        }

        // Generate realistic coordinates for unknown Miami ZIP codes
        function generateMiamiCoordinatesFromZipPattern(zipCode) {
            // Miami-Dade County boundaries
            const miamiLatMin = 25.4500;  // South (Homestead area)
            const miamiLatMax = 25.9500;  // North (Aventura/North Miami Beach)
            const miamiLngMin = -80.5000; // West
            const miamiLngMax = -80.1200; // East (coastline)
            
            // Generate coordinates based on ZIP code pattern within Miami bounds
            const zipSeed = zipCode.split('').reduce((sum, digit) => sum + parseInt(digit), 0);
            const pseudoRandom1 = (zipSeed * 0.1) % 1;
            const pseudoRandom2 = (zipSeed * 0.13) % 1;
            
            const lat = miamiLatMin + pseudoRandom1 * (miamiLatMax - miamiLatMin);
            const lng = miamiLngMin + pseudoRandom2 * (miamiLngMax - miamiLngMin);
            
            return {
                lat: lat,
                lng: lng,
                city: `${zipCode}, Miami-Dade County, FL`
            };
        }

        // Find gas stations near coordinates
        async function findGasStationsNearCoordinates(lat, lng, zipCode) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1200));
            
            // Generate realistic gas stations based on location
            const commonChains = ['Shell', 'BP', 'Exxon', 'Chevron', 'Mobil', 'Sunoco', 'Marathon', 'Speedway', 'Circle K', 'Wawa'];
            const icons = ['🛡️', '🟢', '🔴', '⚡', '🔵', '☀️', '🏃', '⚡', '🟠', '🟣'];
            
            const stations = [];
            const numStations = 4; // Always return exactly 4 stations
            
            // Base gas price varies by region (roughly based on US gas price patterns)
            const regionalPriceMultiplier = getRegionalPriceMultiplier(lat, lng);
            const basePrice = 3.75 * regionalPriceMultiplier;
            
            for (let i = 0; i < numStations; i++) {
                const chainIndex = Math.floor(Math.random() * commonChains.length);
                const chain = commonChains[chainIndex];
                const icon = icons[chainIndex];
                
                // Generate realistic distances (0.1 to 2.5 miles)
                const distance = (0.1 + Math.random() * 2.4).toFixed(1);
                
                // Generate realistic street names
                const streets = generateNearbyStreets(lat, lng);
                const street = streets[i % streets.length];
                
                // Price variation by chain and location
                const priceVariation = (Math.random() - 0.5) * 0.3; // ±15 cents
                const gasPrice = basePrice + priceVariation;
                
                // Rating between 4.0 and 4.9
                const rating = (4.0 + Math.random() * 0.9).toFixed(1);
                
                // Features
                const allFeatures = ['24/7 available', 'Car wash', 'Convenience store', 'ATM', 'Quick service', 'Premium quality', 'Loyalty rewards', 'Full service'];
                const features = allFeatures.sort(() => 0.5 - Math.random()).slice(0, 2);
                
                stations.push({
                    name: chain,
                    icon: icon,
                    distance: `${distance} mi`,
                    location: street,
                    rating: parseFloat(rating),
                    gasPrice: parseFloat(gasPrice.toFixed(2)),
                    features: features
                });
            }
            
            // Sort by distance
            stations.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
            
            return stations;
        }

        // Get regional price multiplier based on coordinates
        function getRegionalPriceMultiplier(lat, lng) {
            // California (high prices)
            if (lng < -115 && lat > 32 && lat < 42) {
                return 1.25 + Math.random() * 0.15;
            }
            // Northeast (high prices)
            if (lng > -80 && lat > 40) {
                return 1.15 + Math.random() * 0.1;
            }
            // Texas/Gulf Coast (low prices)
            if (lng > -106 && lng < -93 && lat > 25 && lat < 37) {
                return 0.85 + Math.random() * 0.1;
            }
            // Midwest (moderate prices)
            if (lng > -100 && lng < -80 && lat > 35 && lat < 45) {
                return 0.95 + Math.random() * 0.1;
            }
            // Default
            return 1.0 + Math.random() * 0.1;
        }

        // Generate realistic Miami street names based on location
        function generateNearbyStreets(lat, lng) {
            const miamiStreets = [
                // Major Miami streets and avenues
                'Biscayne Blvd', 'Collins Ave', 'Ocean Drive', 'Lincoln Rd', 'Washington Ave',
                'Alton Rd', 'Coral Way', 'Flagler St', 'Calle Ocho', 'Bird Rd',
                'Kendall Dr', 'Sunset Dr', 'Miller Dr', 'Palmetto Expy', 'US Highway 1',
                'Miracle Mile', 'Le Jeune Rd', 'Douglas Rd', 'Red Rd', 'Ludlam Rd',
                'Krome Ave', 'NW 7th St', 'SW 8th St', 'NE 2nd Ave', 'SW 1st St',
                'Aventura Blvd', 'Harding Ave', 'Bay Harbor Dr', 'Kane Concourse',
                'NW 36th St', 'SW 88th St', 'NW 103rd St', 'SW 152nd St',
                'Homestead Ave', 'Quail Roost Dr', 'SW 136th St', 'NW 199th St'
            ];
            
            // Area-specific streets based on coordinates
            const areaSpecificStreets = [];
            
            // Miami Beach area (higher longitude, closer to coast)
            if (lng > -80.2) {
                areaSpecificStreets.push('Collins Ave', 'Ocean Drive', 'Washington Ave', 'Lincoln Rd', 'Alton Rd');
            }
            
            // Downtown Miami area
            if (lat > 25.7 && lat < 25.8 && lng > -80.2 && lng < -80.1) {
                areaSpecificStreets.push('Biscayne Blvd', 'Flagler St', 'NE 2nd Ave', 'SE 1st St');
            }
            
            // Coral Gables area
            if (lat > 25.7 && lat < 25.8 && lng > -80.3 && lng < -80.2) {
                areaSpecificStreets.push('Miracle Mile', 'Coral Way', 'Le Jeune Rd', 'Douglas Rd');
            }
            
            // South Miami/Homestead area
            if (lat < 25.6) {
                areaSpecificStreets.push('Homestead Ave', 'Krome Ave', 'SW 152nd St', 'SW 136th St');
            }
            
            // North Miami area
            if (lat > 25.85) {
                areaSpecificStreets.push('Aventura Blvd', 'NW 199th St', 'Biscayne Blvd', 'NE 163rd St');
            }
            
            // Combine all streets and return random selection
            const allStreets = [...miamiStreets, ...areaSpecificStreets];
            return allStreets.sort(() => 0.5 - Math.random()).slice(0, 8);
        }

        // Enhanced search function
        async function searchPrices() {
            const location = document.getElementById('priceLocationInput').value.trim();
            const searchBtn = document.getElementById('searchBtnText');
            
            if (!location) {
                showToast('Please enter a ZIP code', 'error');
                return;
            }

            // Extract ZIP code from input
            const zipCode = extractZipCode(location);
            if (!zipCode) {
                showToast('Please enter a valid US ZIP code', 'error');
                return;
            }

            searchBtn.innerHTML = '<div class="loading"></div> Searching...';
            
            // Show loading state
            const container = document.getElementById('gasStationsList');
            container.innerHTML = `
                <div class="loading-stations">
                    <div class="loading"></div>
                    <div>Finding gas stations near ${zipCode}...</div>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem;">This may take a few seconds</div>
                </div>
            `;
            
            try {
                const stations = await findGasStationsForZipCode(zipCode);
                
                if (stations.length > 0) {
                    currentGasStations = stations;
                    lastSearchLocation = location;
                    
                    // Update all views
                    populateGasStations();
                    populateAdminGasStations();
                    updateMobileStations();
                    
                    showToast(`✅ Found ${stations.length} gas stations near ${zipCode}`, 'success');
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">⛽</div>
                            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">No gas stations found</div>
                            <div>Try a different ZIP code</div>
                        </div>
                    `;
                    showToast('❌ No gas stations found in this area', 'error');
                }
            } catch (error) {
                console.error('Search error:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--error);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Search failed</div>
                        <div>Please try again</div>
                    </div>
                `;
                showToast('Error searching for gas stations. Please try again.', 'error');
            } finally {
                searchBtn.textContent = '🔍 Search Gas Stations';
            }
        }

        // Mobile search function
        async function searchMobilePrices() {
            const location = document.getElementById('mobileLocationInput').value.trim();
            const searchBtn = document.getElementById('mobileSearchBtnText');
            
            if (!location) {
                showToast('Please enter a ZIP code', 'error');
                return;
            }

            const zipCode = extractZipCode(location);
            if (!zipCode) {
                showToast('Please enter a valid US ZIP code', 'error');
                return;
            }

            searchBtn.innerHTML = '<div class="loading"></div> Searching...';
            
            try {
                const stations = await findGasStationsForZipCode(zipCode);
                
                if (stations.length > 0) {
                    currentGasStations = stations;
                    lastSearchLocation = location;
                    
                    updateMobileStations();
                    populateGasStations();
                    populateAdminGasStations();
                    
                    showToast(`📱 Found ${stations.length} stations near ${zipCode}`, 'success');
                } else {
                    showToast('❌ No gas stations found', 'error');
                }
            } catch (error) {
                showToast('Error searching for gas stations', 'error');
            } finally {
                searchBtn.textContent = 'Find Gas Prices';
            }
        }

        // Extract ZIP code from various input formats
        function extractZipCode(input) {
            // Remove all non-digit characters and get first 5 digits
            const digits = input.replace(/\D/g, '');
            if (digits.length >= 5) {
                return digits.substring(0, 5);
            }
            return null;
        }

        // Quick test function for demo buttons
        function testZipCode(zipCode) {
            document.getElementById('priceLocationInput').value = zipCode;
            searchPrices();
        }

        // Clear search and reset to default
        function clearSearch() {
            currentGasStations = [];
            lastSearchLocation = '';
            
            document.getElementById('priceLocationInput').value = '';
            document.getElementById('mobileLocationInput').value = '';
            
            loadDefaultGasStations();
            showToast('🧹 Search cleared - showing default Miami Beach stations', 'info');
        }

        // Load default gas stations (Miami Beach)
        function loadDefaultGasStations() {
            const defaultStations = [
                { name: 'Shell', icon: '🛡️', distance: '0.5 mi', location: 'Ocean Drive', rating: 4.7, gasPrice: 4.04, features: ['Beach location', '24/7'] },
                { name: 'BP', icon: '🟢', distance: '0.8 mi', location: 'Collins Ave', rating: 4.4, gasPrice: 3.98, features: ['Tourist area', 'Quick'] },
                { name: 'Chevron', icon: '⚡', distance: '1.1 mi', location: 'Washington Ave', rating: 4.5, gasPrice: 4.09, features: ['South Beach', 'Premium'] },
                { name: 'Mobil', icon: '🔴', distance: '1.3 mi', location: 'Alton Rd', rating: 4.2, gasPrice: 3.95, features: ['Full service', 'Car wash'] }
            ];
            
            currentGasStations = defaultStations;
            populateGasStations();
            populateAdminGasStations();
            updateMobileStations();
        }

        // Populate gas stations list
        function populateGasStations() {
            const container = document.getElementById('gasStationsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (currentGasStations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🔍</div>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Search for gas stations</div>
                        <div>Enter any US ZIP code above to find nearby gas stations</div>
                    </div>
                `;
                return;
            }
            
            currentGasStations.forEach((station, index) => {
                const ourPrice = currentPrices.premium;
                const savings = (station.gasPrice - ourPrice);
                const savingsPercent = ((savings / station.gasPrice) * 100);
                
                const stationElement = document.createElement('div');
                stationElement.className = 'gas-station';
                stationElement.innerHTML = `
                    <div class="station-info">
                        <div class="station-name">${station.icon} ${station.name}</div>
                        <div class="station-details">📍 ${station.distance} • ${station.location}</div>
                        <div class="station-rating">
                            <span>⭐ ${station.rating}</span>
                            <span>•</span>
                            <span>${station.features.join(' • ')}</span>
                        </div>
                    </div>
                    <div class="price-comparison">
                        <div class="price-row">
                            <span class="price-label">Gas Station:</span>
                            <span class="price gas-price">$${station.gasPrice.toFixed(2)}</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">FuelFlow:</span>
                            <span class="price our-price">$${ourPrice.toFixed(2)}</span>
                        </div>
                        <div class="savings">Save $${savings.toFixed(2)} (${savingsPercent.toFixed(0)}%)</div>
                    </div>
                `;
                
                stationElement.addEventListener('click', () => {
                    document.querySelectorAll('.gas-station').forEach(s => s.classList.remove('selected'));
                    stationElement.classList.add('selected');
                    showToast(`Selected ${station.name} station`, 'info');
                });
                
                container.appendChild(stationElement);
            });
        }

        // Populate admin gas stations
        function populateAdminGasStations() {
            const container = document.getElementById('adminGasStationsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (currentGasStations.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">No gas stations loaded. Search for a location first.</div>';
                return;
            }
            
            currentGasStations.forEach((station) => {
                const ourPrice = currentPrices.premium;
                const margin = (station.gasPrice - ourPrice);
                
                const stationElement = document.createElement('div');
                stationElement.className = 'gas-station';
                stationElement.innerHTML = `
                    <div class="station-info">
                        <div class="station-name">${station.icon} ${station.name}</div>
                        <div class="station-details">📍 ${station.distance} • ${station.location}</div>
                        <div class="station-rating">⭐ ${station.rating} • ${station.features.join(' • ')}</div>
                    </div>
                    <div class="price-comparison">
                        <div class="price-row">
                            <span class="price-label">Their Price:</span>
                            <span class="price gas-price">$${station.gasPrice.toFixed(2)}</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Our Price:</span>
                            <span class="price our-price">$${ourPrice.toFixed(2)}</span>
                        </div>
                        <div class="savings">Margin: $${margin.toFixed(2)}</div>
                    </div>
                `;
                
                container.appendChild(stationElement);
            });
        }

        // Update mobile stations
        function updateMobileStations() {
            const container = document.getElementById('mobileStationsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (currentGasStations.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--text-secondary); font-size: 0.9rem;">Search for gas stations above</div>';
                return;
            }
            
            // Show first 3 stations in mobile view
            currentGasStations.slice(0, 3).forEach((station, index) => {
                const ourPrice = currentPrices.premium;
                const savings = (station.gasPrice - ourPrice);
                
                const stationElement = document.createElement('div');
                stationElement.style.cssText = `
                    background: var(--glass); 
                    border: 1px solid ${index === 0 ? 'var(--accent)' : 'var(--glass-border)'}; 
                    border-radius: 12px; 
                    padding: 1rem; 
                    margin-bottom: 0.8rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;
                
                stationElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.3rem;">${station.icon} ${station.name}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${station.distance} • ${station.location}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: var(--error); font-weight: 600;">$${station.gasPrice.toFixed(2)}</div>
                            <div style="color: var(--success); font-size: 0.8rem;">Save $${savings.toFixed(2)}</div>
                        </div>
                    </div>
                `;
                
                stationElement.addEventListener('click', () => {
                    document.querySelectorAll('#mobileStationsContainer > div').forEach(s => s.style.borderColor = 'var(--glass-border)');
                    stationElement.style.borderColor = 'var(--accent)';
                });
                
                container.appendChild(stationElement);
            });
        }

        // Other functions (login, navigation, etc.)
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;
                    switchSection(section);
                });
            });
        }

        function switchSection(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            activeSection = section;
        }

        function setupPaymentMethods() {
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', () => {
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.style.borderColor = 'var(--glass-border)';
                        m.classList.remove('selected');
                    });
                    method.style.borderColor = 'var(--accent)';
                    method.classList.add('selected');
                    selectedPayment = method.dataset.payment;
                    showToast(`Selected ${method.querySelector('div:last-child').textContent}`, 'info');
                });
            });
        }

        function updatePricing() {
            const fuelType = document.getElementById('fuelTypeSelect')?.value || 'premium';
            const amount = parseFloat(document.getElementById('amountSelect')?.value || 15);
            
            const fuelPrice = currentPrices[fuelType];
            const fuelCost = fuelPrice * amount;
            const deliveryFee = currentPrices.deliveryFee;
            const total = fuelCost + deliveryFee;
            
            const gasStationPrice = fuelPrice * 1.06;
            const savings = (gasStationPrice - fuelPrice) * amount;

            // Update displays
            if (document.getElementById('gallonAmount')) document.getElementById('gallonAmount').textContent = amount;
            if (document.getElementById('fuelPriceDisplay')) document.getElementById('fuelPriceDisplay').textContent = fuelPrice.toFixed(2);
            if (document.getElementById('fuelCostDisplay')) document.getElementById('fuelCostDisplay').textContent = `$${fuelCost.toFixed(2)}`;
            if (document.getElementById('deliveryFeeDisplay')) document.getElementById('deliveryFeeDisplay').textContent = `$${deliveryFee.toFixed(2)}`;
            if (document.getElementById('savingsDisplay')) document.getElementById('savingsDisplay').textContent = `$${savings.toFixed(2)}`;
            if (document.getElementById('totalCostDisplay')) document.getElementById('totalCostDisplay').textContent = `$${total.toFixed(2)}`;
            
            // Update mobile displays
            if (document.getElementById('mobileTotalDisplay')) document.getElementById('mobileTotalDisplay').textContent = total.toFixed(2);
            if (document.getElementById('mobileSavingsDisplay')) document.getElementById('mobileSavingsDisplay').textContent = savings.toFixed(2);
            
            // Update price selectors
            document.querySelectorAll('.mobile-our-price').forEach(el => {
                el.textContent = currentPrices.premium.toFixed(2);
            });
        }

        function updateAdminPrices() {
            const premium = parseFloat(document.getElementById('premiumPriceInput').value);
            const regular = parseFloat(document.getElementById('regularPriceInput').value);
            const diesel = parseFloat(document.getElementById('dieselPriceInput').value);
            const deliveryFee = parseFloat(document.getElementById('deliveryFeeInput').value);

            if (isNaN(premium) || isNaN(regular) || isNaN(diesel) || isNaN(deliveryFee)) {
                showToast('Please enter valid prices', 'error');
                return;
            }

            currentPrices = { premium, regular, diesel, deliveryFee };
            
            updatePricing();
            populateGasStations();
            populateAdminGasStations();
            updateMobileStations();
            
            showToast('Prices updated successfully! Changes reflected across all screens.', 'success');
        }

        function saveAdminPrices() {
            showToast('Prices saved successfully! 💾', 'success');
        }

        // Login functions
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email && password) {
                currentUser = { email, type: email.includes('admin') ? 'admin' : 'customer' };
                isAdmin = currentUser.type === 'admin';
                showApp();
                showToast(`Welcome back, ${email}!`, 'success');
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const zipCode = document.getElementById('zipCode').value;
            const subscriptionPlan = document.querySelector('input[name="subscription"]:checked').value;
            
            // Validate Miami ZIP code
            if (!zipCode.match(/^33[0-9]{3}$/)) {
                showToast('Please enter a valid Miami ZIP code (33xxx)', 'error');
                return;
            }
            
            if (fullName && email && password && zipCode) {
                // Simulate subscription processing
                showToast('Processing subscription...', 'info');
                
                setTimeout(() => {
                    currentUser = { 
                        email, 
                        fullName, 
                        type: 'customer',
                        zipCode,
                        subscriptionPlan,
                        subscriptionActive: true
                    };
                    
                    // Save subscription status
                    localStorage.setItem('subscriptionActive', 'true');
                    localStorage.setItem('subscriptionPlan', subscriptionPlan);
                    localStorage.setItem('userZipCode', zipCode);
                    
                    isAdmin = false;
                    showApp();
                    showToast(`Welcome to FuelFlow, ${fullName}! Your ${subscriptionPlan} subscription is now active.`, 'success');
                }, 2000);
            }
        }

        function loginAsGuest() {
            currentUser = { email: 'guest@fuelflow.com', type: 'guest' };
            isAdmin = false;
            showApp();
            showToast('Welcome! You are browsing as a guest.', 'info');
        }

        function logout() {
            currentUser = null;
            isAdmin = false;
            showLoginScreen();
            showToast('Logged out successfully', 'info');
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('signupScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('active');
        }

        function showSignupScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('signupScreen').classList.remove('hidden');
            document.getElementById('appContainer').classList.remove('active');
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('signupScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.add('active');
            
            const welcomeEl = document.getElementById('userWelcome');
            if (currentUser && currentUser.fullName) {
                welcomeEl.textContent = `Welcome, ${currentUser.fullName}!`;
            } else if (currentUser && currentUser.email) {
                welcomeEl.textContent = `Welcome, ${currentUser.email}!`;
            }
            
            updatePricing();
        }

        function handleOrder() {
            // Check subscription status first
            if (!requireSubscription('place order')) {
                return;
            }
            
            const button = event.target;
            const originalText = button.innerHTML;
            const paymentMethod = selectedPayment === 'stripe' ? 'Credit Card' : 'Zelle';
            
            // Validate required fields
            const location = document.getElementById('locationInput').value.trim();
            const vehicleType = document.getElementById('vehicleSelect').value;
            const vehicleDetails = document.getElementById('vehicleDetails').value.trim();
            const fuelTankInstructions = document.getElementById('fuelTankInstructions').value.trim();
            
            if (!location) {
                showToast('Please enter a delivery location', 'error');
                return;
            }
            
            if (!vehicleType) {
                showToast('Please select your vehicle type', 'error');
                return;
            }
            
            if (!vehicleDetails) {
                showToast('Please enter your vehicle details', 'error');
                return;
            }
            
            if (!fuelTankInstructions) {
                showToast('Please provide fuel tank opening instructions', 'error');
                return;
            }
            
            // Check if location is in Miami
            if (!location.match(/33[0-9]{3}/) && !location.toLowerCase().includes('miami')) {
                showToast('Delivery is only available in Miami-Dade County', 'error');
                return;
            }
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Order...';
            button.disabled = true;
            
            // Simulate order processing
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check"></i> Order Placed!';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    const deliveryNotes = document.getElementById('deliveryNotes').value.trim();
                    const contactPreference = document.getElementById('contactPreference').value;
                    
                    showToast(`Order placed successfully! Payment via ${paymentMethod}. You'll be contacted via ${contactPreference.replace('text', 'text message').replace('call', 'phone call').replace('app', 'app notification')}.`, 'success');
                }, 1000);
            }, 2000);
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 4000);
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>