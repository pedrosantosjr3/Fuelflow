<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FuelFlow - Premium Fuel Delivery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        :root {
            /* iOS-inspired calm color palette */
            --primary: #007AFF;           /* iOS blue - calm & trustworthy */
            --primary-light: #4A90E2;     /* Light iOS blue */
            --secondary: #34C759;         /* iOS green - success & growth */
            --secondary-light: #5AC669;   /* Light iOS green */
            --accent: #5856D6;           /* iOS purple - elegant accent */
            --accent-light: #7B7AE8;     /* Light iOS purple */
            --success: #30D158;          /* iOS success green */
            --warning: #FF9500;          /* iOS orange - warm warning */
            --error: #FF3B30;           /* iOS red - gentle alert */
            --text-primary: #000000;     /* iOS black text */
            --text-secondary: #8E8E93;   /* iOS secondary gray */
            --text-light: #C7C7CC;      /* iOS light gray */
            --background: #F2F2F7;       /* iOS background gray */
            --surface: #FFFFFF;          /* Pure white surfaces */
            --surface-soft: #F2F2F7;     /* iOS grouped background */
            --border: #C6C6C8;           /* iOS separator gray */
            --border-light: #F2F2F2;     /* Very light separator */
            
            /* Calm iOS-style gradients */
            --gradient-hero: linear-gradient(135deg, #007AFF 0%, #34C759 100%);
            --gradient-savings: linear-gradient(135deg, #34C759 0%, #30D158 100%);
            --gradient-trust: linear-gradient(135deg, #5856D6 0%, #007AFF 100%);
            --gradient-soft: linear-gradient(135deg, #F2F2F7 0%, #FFFFFF 100%);
            
            /* iOS glass effects */
            --glass: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.04);
            --glass-strong: rgba(255, 255, 255, 0.95);
            
            /* iOS shadows */
            --shadow-soft: 0 2px 10px rgba(0, 0, 0, 0.04);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.06);
            --shadow-strong: 0 8px 30px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            /* iOS touch optimizations */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Remove animated background for cleaner iOS look */

        /* Mobile App Container */
        .mobile-app {
            max-width: 430px;
            width: 100%;
            min-height: 100vh;
            margin: 0 auto;
            background: var(--surface);
            position: relative;
            box-shadow: var(--shadow-medium);
            overflow: hidden;
        }

        /* iOS-style cards */
        .glass {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: var(--shadow-soft);
        }

        .glass-strong {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: var(--shadow-medium);
        }
        
        /* iOS button styles */
        .ios-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 17px;
            font-weight: 600;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .ios-button:hover {
            background: var(--primary-light);
            transform: scale(0.98);
        }
        
        .ios-button:active {
            transform: scale(0.96);
            background: var(--primary);
        }
        
        .ios-button-secondary {
            background: var(--surface);
            color: var(--primary);
            border: 1px solid var(--border);
        }
        
        .ios-button-secondary:hover {
            background: var(--surface-soft);
        }

        /* Improved Settings Panel */
        .settings-btn {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            color: var(--text-primary);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            backdrop-filter: blur(24px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .settings-btn:hover {
            background: var(--gradient-primary);
            transform: translateY(-2px) scale(1.05);
            color: white;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -420px;
            width: 420px;
            height: 100vh;
            background: var(--glass-strong);
            backdrop-filter: blur(32px);
            border-left: 1px solid var(--glass-border);
            z-index: 1001;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 2rem;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .settings-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Enhanced Login Screen */
        .login-screen, .signup-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--background);
            z-index: 999;
            transition: all 0.4s ease;
        }

        .login-screen.hidden, .signup-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .login-box {
            background: var(--glass-strong);
            backdrop-filter: blur(32px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 3rem;
            width: 90%;
            max-width: 480px;
            text-align: center;
            animation: slideInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl);
        }

        .logo {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Enhanced Form Styling */
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 1.2rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1rem;
            backdrop-filter: blur(16px);
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        /* Enhanced Buttons */
        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            width: 100%;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 217, 255, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .btn-outline:hover {
            background: var(--accent);
            color: white;
        }

        /* Subscription Plans */
        .subscription-plans {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .plan-option {
            position: relative;
        }

        .plan-option input[type="radio"] {
            opacity: 0;
            position: absolute;
        }

        .plan-label {
            display: block;
            background: var(--glass);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-option input[type="radio"]:checked + .plan-label {
            border-color: var(--accent);
            background: var(--glass-strong);
            box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
        }

        .plan-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .plan-price {
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .save-badge {
            background: var(--success);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .plan-features {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Photo Upload Areas */
        .photo-upload-area {
            border: 2px dashed var(--border);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--glass);
        }

        .photo-upload-area:hover {
            border-color: var(--accent);
            background: var(--glass-strong);
        }

        .photo-upload-area.dragover {
            border-color: var(--accent);
            background: rgba(0, 217, 255, 0.1);
        }

        .upload-content {
            pointer-events: none;
        }

        .photo-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .photo-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .photo-preview .remove-photo {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .photo-preview .remove-photo:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* Enhanced App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .app-container.active {
            display: block;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem 2rem;
            background: var(--glass-strong);
            border-radius: 24px;
            backdrop-filter: blur(32px);
            box-shadow: var(--shadow);
        }

        .app-logo {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Enhanced Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 2rem;
            align-items: start;
        }

        /* Enhanced Navigation */
        .nav-container {
            background: var(--glass-strong);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(32px);
            box-shadow: var(--shadow);
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-link {
            padding: 1.2rem 2rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-primary);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .nav-link:hover::before, .nav-link.active::before {
            left: 0;
        }

        .nav-link:hover, .nav-link.active {
            color: white;
            transform: translateY(-2px);
            border-color: transparent;
        }

        /* Enhanced Content Sections */
        .content-section {
            background: var(--glass-strong);
            border-radius: 24px;
            padding: 2rem;
            backdrop-filter: blur(32px);
            animation: fadeInUp 0.6s ease;
            box-shadow: var(--shadow);
        }

        .content-section.hidden {
            display: none;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        /* Enhanced Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .stat-card:hover::before {
            opacity: 0.1;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
        }

        /* Enhanced Location Search */
        .location-search {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .location-search::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 20px 20px 0 0;
        }

        .search-input {
            width: 100%;
            padding: 1.2rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
            transform: translateY(-1px);
        }

        .search-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 217, 255, 0.3);
        }

        /* Enhanced Gas Stations List */
        .gas-stations-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 12px;
        }

        .gas-stations-container::-webkit-scrollbar {
            width: 6px;
        }

        .gas-stations-container::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 3px;
        }

        .gas-stations-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .gas-stations-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        .gas-station {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .gas-station::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: -1;
        }

        .gas-station:hover::before {
            left: 0;
            opacity: 0.1;
        }

        .gas-station:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--accent);
        }

        .gas-station.selected {
            border-color: var(--accent);
            background: var(--glass-strong);
        }

        .gas-station.selected::before {
            left: 0;
            opacity: 0.15;
        }

        .station-info {
            flex: 1;
        }

        .station-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.01em;
        }

        .station-details {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .station-rating {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .price-comparison {
            text-align: right;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            min-width: 180px;
        }

        .price-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .price {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .gas-price {
            color: var(--error);
        }

        .our-price {
            color: var(--success);
        }

        .savings {
            color: var(--success);
            font-weight: 700;
            font-size: 1.1rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
            margin-top: 0.5rem;
        }

        /* Enhanced Phone Demo */
        .phone-demo {
            position: sticky;
            top: 2rem;
            background: var(--glass-strong);
            border-radius: 32px;
            padding: 1.5rem;
            backdrop-filter: blur(32px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-xl);
            max-width: 420px;
        }

        .phone-screen {
            background: var(--gradient-surface);
            border-radius: 28px;
            padding: 1.5rem;
            min-height: 600px;
            max-height: 700px;
            position: relative;
            overflow-y: auto;
            border: 8px solid var(--primary);
            box-shadow: 
                0 0 0 2px var(--border),
                0 0 32px rgba(0,0,0,0.4),
                inset 0 0 0 1px var(--glass-border);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--glass-strong);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            backdrop-filter: blur(24px);
            z-index: 10000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast.info {
            border-left: 4px solid var(--accent);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .phone-demo {
                position: static;
                max-width: 420px;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .login-box {
                margin: 1rem;
                padding: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Mobile Section Styles */
        .mobile-section {
            transition: opacity 0.3s ease;
        }

        .mobile-nav-btn {
            transition: all 0.3s ease;
        }

        .mobile-nav-btn:hover {
            background: var(--glass) !important;
        }

        /* Special loading state for gas stations */
        .loading-stations {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
            color: var(--text-secondary);
        }

        .loading-stations .loading {
            width: 32px;
            height: 32px;
            border-width: 3px;
            margin-bottom: 1rem;
        }

        /* Enhanced quick test buttons */
        .quick-test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .quick-test-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .quick-test-btn:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-1px);
        }
        
        /* Savings calculator animations */
        .savings-animation {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        .savings-breakdown {
            animation: slideInUp 0.8s ease;
        }
        
        .savings-highlight {
            background: var(--gradient-savings);
            color: white;
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .savings-amount {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        
        .savings-yearly {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .convenience-benefits {
            display: grid;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .benefit-item {
            background: var(--surface-soft);
            padding: 0.8rem;
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .savings-error {
            text-align: center;
            padding: 1.5rem;
            color: var(--error);
            background: #FEF2F2;
            border: 1px solid #FECACA;
            border-radius: 16px;
        }
        
        .error-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        /* App section styles */
        .app-section {
            animation: fadeInUp 0.3s ease;
        }
        
        .app-tab:hover {
            background: rgba(0, 122, 255, 0.1) !important;
            color: var(--primary) !important;
        }
    </style>
</head>
<body>
    <!-- Mobile App Container -->
    <div class="mobile-app">
        
        <!-- Landing/Welcome Screen -->
        <div class="landing-screen" id="landingScreen">
            <!-- Hero Section -->
            <div style="background: var(--gradient-hero); padding: 3rem 1.5rem 2rem; text-align: center; color: white; position: relative; overflow: hidden;">
                
                <div style="position: relative; z-index: 1;">
                    <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; letter-spacing: -0.02em;">‚õΩ FuelFlow</div>
                    <div style="font-size: 1.1rem; font-weight: 500; opacity: 0.95; margin-bottom: 2rem;">Premium fuel delivery to your door</div>
                    
                    <!-- Value Proposition Cards -->
                    <div style="display: grid; gap: 0.8rem; margin-bottom: 2rem;">
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 16px; padding: 1.2rem; text-align: left; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div style="background: rgba(52, 199, 89, 0.2); border-radius: 12px; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;">
                                    <span style="font-size: 1.3rem;">üí∞</span>
                                </div>
                                <div>
                                    <div style="font-size: 1.1rem; font-weight: 600; color: white; margin-bottom: 0.2rem;">Save Money</div>
                                    <div style="font-size: 0.85rem; opacity: 0.8;">$0.25-$0.40 per gallon</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.15); border-radius: 16px; padding: 1.2rem; text-align: left; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div style="background: rgba(0, 122, 255, 0.2); border-radius: 12px; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;">
                                    <span style="font-size: 1.3rem;">üöó</span>
                                </div>
                                <div>
                                    <div style="font-size: 1.1rem; font-weight: 600; color: white; margin-bottom: 0.2rem;">Home Delivery</div>
                                    <div style="font-size: 0.85rem; opacity: 0.8;">$4.99 flat fee anywhere</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button id="startTrialBtn" class="ios-button" style="background: white; color: var(--primary); font-weight: 700; margin-bottom: 1rem;">
                        Start FREE 2-Week Trial
                    </button>
                    
                    <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;">
                        ‚úì No credit card required ‚Ä¢ ‚úì Cancel anytime ‚Ä¢ ‚úì Safe & reliable
                    </div>
                </div>
            </div>
            
            <!-- Savings Calculator -->
            <div style="padding: 2rem 1.5rem; background: var(--surface);">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 1.8rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">See Your Savings Today</div>
                    <div style="color: var(--text-secondary); font-size: 1rem;">Real Miami gas prices vs FuelFlow prices</div>
                </div>
                
                <div style="background: var(--surface-soft); border-radius: 20px; padding: 1.5rem; margin-bottom: 1.5rem;">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <label style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Enter your ZIP code</label>
                        <input type="text" id="savingsZipInput" placeholder="33139" maxlength="5" style="width: 100%; padding: 1rem; border: 2px solid var(--border-light); border-radius: 16px; font-size: 1.1rem; text-align: center; font-weight: 600; background: white;">
                    </div>
                    
                    <div id="savingsComparison" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="background: #FEF2F2; border: 2px solid #FECACA; border-radius: 16px; padding: 1.5rem; text-align: center;">
                            <div style="color: #DC2626; font-weight: 600; margin-bottom: 0.5rem;">‚õΩ Gas Stations</div>
                            <div style="font-size: 2rem; font-weight: 800; color: #DC2626; margin-bottom: 0.5rem;" id="stationPrice">$4.09</div>
                            <div style="color: #7F1D1D; font-size: 0.9rem;">per gallon average</div>
                        </div>
                        
                        <div style="background: #F0FDF4; border: 2px solid #BBF7D0; border-radius: 16px; padding: 1.5rem; text-align: center;">
                            <div style="color: var(--secondary); font-weight: 600; margin-bottom: 0.5rem;">üéØ FuelFlow</div>
                            <div style="font-size: 2rem; font-weight: 800; color: var(--secondary); margin-bottom: 0.5rem;" id="fuelflowPrice">$3.79</div>
                            <div style="color: #166534; font-size: 0.9rem;">delivered to you</div>
                        </div>
                    </div>
                    
                    <div id="savingsResults" style="text-align: center; margin-top: 1.2rem; padding: 1.2rem; background: var(--secondary); border-radius: 12px; color: white;">
                        <div style="font-size: 15px; font-weight: 500; margin-bottom: 0.4rem; opacity: 0.9;">You Save</div>
                        <div style="font-size: 2.2rem; font-weight: 700;" id="savingsAmount">$0.30</div>
                        <div style="font-size: 13px; opacity: 0.8;">per gallon + convenience</div>
                    </div>
                </div>
                
                <button id="getStartedBtn" class="ios-button" style="margin-bottom: 1rem;">
                    Get Started - 14 Days FREE
                </button>
                
                <div style="text-align: center; margin-top: 0.5rem;">
                    <button id="loginExistingBtn" class="ios-button-secondary" style="background: none; border: none; font-size: 16px; padding: 12px;">
                        Already have an account? Sign in
                    </button>
                </div>
            </div>
            
            <!-- Trust Indicators -->
            <div style="padding: 1.5rem; background: var(--surface-soft); text-align: center;">
                <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 1.2rem; font-weight: 500;">Trusted by Miami residents</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div style="text-align: center; background: var(--surface); padding: 0.8rem; border-radius: 12px; border: 1px solid var(--border-light);">
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--primary); margin-bottom: 0.2rem;">24/7</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Service</div>
                    </div>
                    <div style="text-align: center; background: var(--surface); padding: 0.8rem; border-radius: 12px; border: 1px solid var(--border-light);">
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--secondary); margin-bottom: 0.2rem;">4.9‚òÖ</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Rating</div>
                    </div>
                    <div style="text-align: center; background: var(--surface); padding: 0.8rem; border-radius: 12px; border: 1px solid var(--border-light);">
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--accent); margin-bottom: 0.2rem;">Safe</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">& Insured</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Login Screen -->
        <div class="hidden" id="loginScreen" style="padding: 2rem 1.5rem; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; background: var(--background);">
            <div style="text-align: center; margin-bottom: 3rem;">
                <div style="font-size: 2.2rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">‚õΩ FuelFlow</div>
                <div style="font-size: 16px; color: var(--text-secondary); font-weight: 500;">Welcome back</div>
            </div>
            
            <form id="loginForm" style="margin-bottom: 2rem;">
                <div style="margin-bottom: 1.5rem;">
                    <input type="email" id="email" placeholder="Email" required style="width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 17px; background: var(--surface); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                </div>
                <div style="margin-bottom: 2rem;">
                    <input type="password" id="password" placeholder="Password" required style="width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 17px; background: var(--surface); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                </div>
                <button type="submit" class="ios-button" style="margin-bottom: 1rem;">Sign In</button>
            </form>
            
            <button class="ios-button-secondary" id="signupBtn" style="margin-bottom: 1rem;">Create Account</button>
            <button class="ios-button-secondary" id="guestBtn">Browse as Guest</button>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button onclick="showScreen('landing')" style="background: none; border: none; color: var(--text-secondary); font-size: 16px; cursor: pointer;">‚Üê Back to Welcome</button>
            </div>
        </div>
        
        <!-- Signup Screen -->
        <div class="hidden" id="signupScreen" style="padding: 2rem 1.5rem; min-height: 100vh; background: var(--background); overflow-y: auto;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="font-size: 2.2rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">‚õΩ FuelFlow</div>
                <div style="font-size: 16px; color: var(--text-secondary); font-weight: 500;">Start your free trial</div>
            </div>
            
            <form id="signupForm">
                <div style="margin-bottom: 1.2rem;">
                    <input type="text" id="fullName" placeholder="Full Name" required style="width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 17px; background: var(--surface); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                </div>
                <div style="margin-bottom: 1.2rem;">
                    <input type="email" id="signupEmail" placeholder="Email" required style="width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 17px; background: var(--surface); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                </div>
                <div style="margin-bottom: 1.2rem;">
                    <input type="password" id="signupPassword" placeholder="Password" required style="width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 17px; background: var(--surface); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                </div>
                <div style="margin-bottom: 2rem;">
                    <input type="text" id="zipCode" placeholder="Miami ZIP code (33xxx)" pattern="33[0-9]{3}" required style="width: 100%; padding: 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 17px; background: var(--surface); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                </div>
                
                <!-- Subscription Plans -->
                <div style="margin-bottom: 2rem;">
                    <div style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem; text-align: center;">Choose Your Plan</div>
                    
                    <div style="background: var(--surface); border: 1px solid var(--border-light); border-radius: 16px; padding: 1rem; margin-bottom: 0.8rem; cursor: pointer;" onclick="selectPlan('trial')">
                        <input type="radio" name="subscription" value="trial" id="trialPlan" checked style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 17px; font-weight: 600; color: var(--secondary); margin-bottom: 0.2rem;">üéâ Free Trial</div>
                                <div style="font-size: 14px; color: var(--text-secondary);">14 days ‚Ä¢ Full access ‚Ä¢ Cancel anytime</div>
                            </div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--secondary);">FREE</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--surface); border: 1px solid var(--border-light); border-radius: 16px; padding: 1rem; margin-bottom: 0.8rem; cursor: pointer; opacity: 0.6;" onclick="selectPlan('monthly')">
                        <input type="radio" name="subscription" value="monthly" id="monthlyPlan" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 17px; font-weight: 600; color: var(--text-primary); margin-bottom: 0.2rem;">Monthly Plan</div>
                                <div style="font-size: 14px; color: var(--text-secondary);">Unlimited deliveries ‚Ä¢ Premium support</div>
                            </div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--text-primary);">$29.99</div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="ios-button" id="signupSubmitBtn" style="margin-bottom: 1rem;">Start Free Trial</button>
            </form>
            
            <div style="text-align: center;">
                <button id="backToLoginBtn" style="background: none; border: none; color: var(--text-secondary); font-size: 16px; cursor: pointer;">‚Üê Back to Sign In</button>
            </div>
        </div>
        
        <!-- App Content (placeholder for after login) -->
        <div class="hidden" id="appContainer" style="padding: 1rem; min-height: 100vh; background: var(--background);">
            <!-- Navigation Tabs -->
            <div style="display: flex; background: var(--surface); border-radius: 12px; padding: 4px; margin-bottom: 1.5rem; border: 1px solid var(--border-light);">
                <button onclick="showAppSection('dashboard')" class="app-tab active" id="dashboardTab" style="flex: 1; padding: 12px; border: none; background: var(--primary); color: white; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s ease;">Dashboard</button>
                <button onclick="showAppSection('customers')" class="app-tab" id="customersTab" style="flex: 1; padding: 12px; border: none; background: transparent; color: var(--text-secondary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s ease;">Customers</button>
                <button onclick="showAppSection('orders')" class="app-tab" id="ordersTab" style="flex: 1; padding: 12px; border: none; background: transparent; color: var(--text-secondary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s ease;">Orders</button>
            </div>
            
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="app-section">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 1.8rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;">Welcome to FuelFlow!</div>
                    <div style="font-size: 16px; color: var(--text-secondary);" id="userWelcome">Your account is ready</div>
                </div>
                
                <!-- Stats Cards -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-light); text-align: center;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="totalCustomersCount">-</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">Total Customers</div>
                    </div>
                    <div style="background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-light); text-align: center;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--secondary); margin-bottom: 0.5rem;" id="totalOrdersCount">-</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">Total Orders</div>
                    </div>
                </div>
                
                <button class="ios-button" onclick="logout()" style="margin-top: 2rem;">Sign Out</button>
            </div>
            
            <!-- Customers Section -->
            <div id="customersSection" class="app-section hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Customers</div>
                    <button onclick="loadCustomersData()" class="ios-button-secondary" style="padding: 8px 16px; font-size: 14px;">Refresh</button>
                </div>
                
                <div id="customersContainer" style="background: var(--surface); border-radius: 12px; border: 1px solid var(--border-light); min-height: 200px; padding: 1rem;">
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Click Refresh to load customer data</div>
                </div>
            </div>
            
            <!-- Orders Section -->
            <div id="ordersSection" class="app-section hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary);">Orders</div>
                    <button onclick="loadOrdersData()" class="ios-button-secondary" style="padding: 8px 16px; font-size: 14px;">Refresh</button>
                </div>
                
                <div id="ordersContainer" style="background: var(--surface); border-radius: 12px; border: 1px solid var(--border-light); min-height: 200px; padding: 1rem;">
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">Click Refresh to load orders data</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDemo-Replace-With-Real-Key",
            authDomain: "fuelflow-demo.firebaseapp.com",
            projectId: "fuelflow-demo",
            storageBucket: "fuelflow-demo.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:demo123456"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Global State
        let currentUser = null;
        let isAdmin = false;
        let activeSection = 'dashboard';
        let currentPrices = {
            premium: 3.79,
            regular: 3.59,
            diesel: 4.12,
            deliveryFee: 4.99
        };
        let selectedPayment = 'stripe';
        let currentGasStations = [];
        let lastSearchLocation = '';

        // Firebase Database Functions
        
        // Save customer to database
        async function saveCustomer(customerData) {
            try {
                const docRef = await db.collection('customers').add({
                    ...customerData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Customer saved with ID:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('Error saving customer:', error);
                throw error;
            }
        }
        
        // Save order to database
        async function saveOrder(orderData) {
            try {
                const docRef = await db.collection('orders').add({
                    ...orderData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'pending'
                });
                console.log('Order saved with ID:', docRef.id);
                return docRef.id;
            } catch (error) {
                console.error('Error saving order:', error);
                throw error;
            }
        }
        
        // Get customer data
        async function getCustomer(customerId) {
            try {
                const doc = await db.collection('customers').doc(customerId).get();
                if (doc.exists) {
                    return { id: doc.id, ...doc.data() };
                } else {
                    console.log('No customer found');
                    return null;
                }
            } catch (error) {
                console.error('Error getting customer:', error);
                throw error;
            }
        }
        
        // Get all customers (admin view)
        async function getAllCustomers() {
            try {
                const snapshot = await db.collection('customers')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const customers = [];
                snapshot.forEach(doc => {
                    customers.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Retrieved', customers.length, 'customers');
                return customers;
            } catch (error) {
                console.error('Error getting customers:', error);
                throw error;
            }
        }
        
        // Get customer orders
        async function getCustomerOrders(customerId) {
            try {
                const snapshot = await db.collection('orders')
                    .where('customerId', '==', customerId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const orders = [];
                snapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                return orders;
            } catch (error) {
                console.error('Error getting orders:', error);
                throw error;
            }
        }
        
        // Update gas station prices in database
        async function updateGasStationPrices(stationData) {
            try {
                await db.collection('gasStations').doc(stationData.id).set({
                    ...stationData,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                console.log('Gas station prices updated');
            } catch (error) {
                console.error('Error updating gas station prices:', error);
                throw error;
            }
        }
        
        // Get analytics data
        async function getAnalytics() {
            try {
                const [customersSnapshot, ordersSnapshot] = await Promise.all([
                    db.collection('customers').get(),
                    db.collection('orders').get()
                ]);
                
                const totalCustomers = customersSnapshot.size;
                const totalOrders = ordersSnapshot.size;
                
                let totalRevenue = 0;
                let completedOrders = 0;
                
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    if (order.status === 'completed') {
                        completedOrders++;
                        totalRevenue += order.total || 0;
                    }
                });
                
                return {
                    totalCustomers,
                    totalOrders,
                    completedOrders,
                    totalRevenue,
                    conversionRate: totalOrders > 0 ? (completedOrders / totalOrders * 100).toFixed(1) : 0
                };
            } catch (error) {
                console.error('Error getting analytics:', error);
                throw error;
            }
        }
        
        // Initialize App
        function init() {
            showLandingPage();
            setupEventListeners();
            setupNavigation();
            setupPaymentMethods();
            setupSettingsPanel();
            setupPhotoUpload();
            setupMobileNavigation();
            setupLandingPageInteractions();
            updatePricing();
            loadUserSettings();
            // Load default gas stations for Miami Beach
            loadDefaultGasStations();
            
            // Initialize Firebase connection
            testFirebaseConnection();
        }
        
        // Test Firebase connection
        async function testFirebaseConnection() {
            try {
                // Test write
                await db.collection('test').doc('connection').set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'connected'
                });
                
                console.log('‚úÖ Firebase connected successfully');
                showToast('Database connected', 'success');
            } catch (error) {
                console.error('‚ùå Firebase connection failed:', error);
                showToast('Database connection failed - using local storage', 'error');
            }
        }

        // Load user settings from localStorage
        function loadUserSettings() {
            const savedZipCode = localStorage.getItem('userZipCode');
            const savedAddress = localStorage.getItem('userAddress');
            
            if (savedZipCode) {
                document.getElementById('userZipCode').value = savedZipCode;
                document.getElementById('locationInput').value = savedAddress || savedZipCode;
            }
            
            if (savedAddress) {
                document.getElementById('userAddress').value = savedAddress;
            }
        }

        // Setup subscription plan selection functionality
        function setupSubscriptionPlanSelection() {
            const subscriptionInputs = document.querySelectorAll('input[name="subscription"]');
            const submitBtn = document.getElementById('signupSubmitBtn');
            
            subscriptionInputs.forEach(input => {
                input.addEventListener('change', (e) => {
                    const selectedPlan = e.target.value;
                    switch(selectedPlan) {
                        case 'trial':
                            submitBtn.textContent = 'Start Free Trial & Create Account';
                            break;
                        case 'monthly':
                            submitBtn.textContent = 'Subscribe Monthly & Create Account';
                            break;
                        case 'annual':
                            submitBtn.textContent = 'Subscribe Annually & Create Account';
                            break;
                    }
                });
            });
        }

        function setupEventListeners() {
            // Login and navigation - with error handling
            const loginForm = document.getElementById('loginForm');
            if (loginForm) loginForm.addEventListener('submit', handleLogin);
            
            const signupForm = document.getElementById('signupForm');
            if (signupForm) signupForm.addEventListener('submit', handleSignup);
            
            setupSubscriptionPlanSelection();
            
            const guestBtn = document.getElementById('guestBtn');
            if (guestBtn) guestBtn.addEventListener('click', () => loginAsGuest());
            
            const signupBtn = document.getElementById('signupBtn');
            if (signupBtn) signupBtn.addEventListener('click', () => showScreen('signup'));
            
            const backToLoginBtn = document.getElementById('backToLoginBtn');
            if (backToLoginBtn) backToLoginBtn.addEventListener('click', () => showScreen('login'));
            
            // Landing page navigation
            const loginExistingBtn = document.getElementById('loginExistingBtn');
            if (loginExistingBtn) loginExistingBtn.addEventListener('click', () => showScreen('login'));
            
            const startTrialBtn = document.getElementById('startTrialBtn');
            if (startTrialBtn) startTrialBtn.addEventListener('click', () => showScreen('signup'));
            
            const getStartedBtn = document.getElementById('getStartedBtn');
            if (getStartedBtn) getStartedBtn.addEventListener('click', () => showScreen('signup'));
            
            // Order functionality
            document.getElementById('orderBtn').addEventListener('click', handleOrder);
            document.getElementById('locationInput').addEventListener('input', updatePricing);
            document.getElementById('fuelTypeSelect').addEventListener('change', updatePricing);
            document.getElementById('amountSelect').addEventListener('change', updatePricing);

            // Search functionality
            document.getElementById('searchPricesBtn').addEventListener('click', searchPrices);
            document.getElementById('mobileSearchBtn').addEventListener('click', searchMobilePrices);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);

            // Admin functionality
            document.getElementById('updatePricesBtn').addEventListener('click', updateAdminPrices);
            document.getElementById('savePricesBtn').addEventListener('click', saveAdminPrices);
        }

        function setupSettingsPanel() {
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsPanel = document.getElementById('settingsPanel');
            const settingsOverlay = document.getElementById('settingsOverlay');
            const themeToggle = document.getElementById('themeToggle');
            const themeToggleThumb = document.getElementById('themeToggleThumb');

            settingsBtn.addEventListener('click', () => {
                settingsPanel.classList.add('active');
                settingsOverlay.classList.add('active');
                updateSubscriptionDisplay();
            });

            document.getElementById('closeSettingsBtn').addEventListener('click', closeSettings);
            settingsOverlay.addEventListener('click', closeSettings);

            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                
                if (newTheme === 'light') {
                    themeToggle.style.background = 'var(--accent)';
                    themeToggleThumb.style.transform = 'translateX(28px)';
                } else {
                    themeToggle.style.background = 'var(--border)';
                    themeToggleThumb.style.transform = 'translateX(0)';
                }
                
                showToast(`Switched to ${newTheme} mode`, 'success');
            });

            // Location settings
            document.getElementById('saveLocationBtn').addEventListener('click', saveUserLocation);
            
            // Subscription management
            document.getElementById('manageSubscriptionBtn').addEventListener('click', () => {
                showToast('Subscription management will open in a new window', 'info');
            });

            function closeSettings() {
                settingsPanel.classList.remove('active');
                settingsOverlay.classList.remove('active');
            }
        }

        // Update subscription display in settings
        function updateSubscriptionDisplay() {
            const statusDiv = document.getElementById('subscriptionStatus');
            const isActive = checkSubscriptionStatus();
            const isTrialUser = localStorage.getItem('isTrialUser') === 'true';
            const plan = localStorage.getItem('subscriptionPlan');
            const remainingDays = getRemainingTrialDays();
            
            if (!isActive) {
                statusDiv.innerHTML = `
                    <div style="color: var(--error); font-weight: 600; margin-bottom: 0.5rem;">‚ö† No Active Subscription</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Subscribe to access all features</div>
                `;
            } else if (isTrialUser && remainingDays !== null) {
                statusDiv.innerHTML = `
                    <div style="color: var(--success); font-weight: 600; margin-bottom: 0.5rem;">üéâ Free Trial Active</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">${remainingDays} days remaining</div>
                    <div style="color: var(--warning); font-size: 0.9rem;">Trial expires: ${new Date(localStorage.getItem('trialEndDate')).toLocaleDateString()}</div>
                `;
            } else {
                const planNames = {
                    'monthly': 'Monthly Plan - $29.99/month',
                    'annual': 'Annual Plan - $299.99/year'
                };
                statusDiv.innerHTML = `
                    <div style="color: var(--success); font-weight: 600; margin-bottom: 0.5rem;">‚úì Active Subscription</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">${planNames[plan] || 'Premium Plan'}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Next billing: ${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
                `;
            }
        }

        // Save user location settings
        function saveUserLocation() {
            const zipCode = document.getElementById('userZipCode').value.trim();
            const address = document.getElementById('userAddress').value.trim();
            
            if (!zipCode.match(/^33[0-9]{3}$/)) {
                showToast('Please enter a valid Miami ZIP code (33xxx)', 'error');
                return;
            }
            
            // Save to localStorage (in real app, would save to server)
            localStorage.setItem('userZipCode', zipCode);
            localStorage.setItem('userAddress', address);
            
            // Auto-fill order form
            document.getElementById('locationInput').value = address || zipCode;
            
            showToast('Location saved successfully!', 'success');
        }

        // Photo upload functionality
        function setupPhotoUpload() {
            setupPhotoUploadArea('vehiclePhotoArea', 'vehiclePhoto', 'vehiclePhotoPreview');
            setupPhotoUploadArea('fuelCapPhotoArea', 'fuelCapPhoto', 'fuelCapPhotoPreview');
        }

        function setupPhotoUploadArea(areaId, inputId, previewId) {
            const area = document.getElementById(areaId);
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            area.addEventListener('click', () => input.click());
            
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('dragover');
            });
            
            area.addEventListener('dragleave', () => {
                area.classList.remove('dragover');
            });
            
            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handlePhotoUpload(files[0], preview);
                }
            });
            
            input.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handlePhotoUpload(e.target.files[0], preview);
                }
            });
        }

        function handlePhotoUpload(file, preview) {
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.innerHTML = `
                    <img src="${e.target.result}" alt="Uploaded photo">
                    <button class="remove-photo" onclick="removePhoto('${preview.id}')">Remove Photo</button>
                `;
                preview.classList.remove('hidden');
                showToast('Photo uploaded successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function removePhoto(previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            preview.classList.add('hidden');
            
            // Clear the input
            const inputId = previewId.replace('Preview', '');
            document.getElementById(inputId).value = '';
            
            showToast('Photo removed', 'info');
        }

        // Check subscription status with trial support
        function checkSubscriptionStatus() {
            const isActive = localStorage.getItem('subscriptionActive') === 'true';
            const isTrialUser = localStorage.getItem('isTrialUser') === 'true';
            const trialEndDate = localStorage.getItem('trialEndDate');
            
            if (!isActive) return false;
            
            // Check if trial has expired
            if (isTrialUser && trialEndDate) {
                const now = new Date();
                const endDate = new Date(trialEndDate);
                if (now > endDate) {
                    // Trial expired
                    localStorage.setItem('subscriptionActive', 'false');
                    showToast('Your free trial has expired. Please subscribe to continue using FuelFlow.', 'error');
                    return false;
                }
            }
            
            return true;
        }

        // Get remaining trial days
        function getRemainingTrialDays() {
            const isTrialUser = localStorage.getItem('isTrialUser') === 'true';
            const trialEndDate = localStorage.getItem('trialEndDate');
            
            if (!isTrialUser || !trialEndDate) return null;
            
            const now = new Date();
            const endDate = new Date(trialEndDate);
            const diffTime = endDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return Math.max(0, diffDays);
        }

        // Allow browsing but require subscription for actions
        function requireSubscription(action) {
            if (!checkSubscriptionStatus()) {
                showToast(`${action} requires an active subscription. You can browse for free, but need to subscribe to place orders!`, 'error');
                document.getElementById('signupBtn').click();
                return false;
            }
            
            // Show trial reminder if user is in trial
            const remainingDays = getRemainingTrialDays();
            if (remainingDays !== null && remainingDays <= 3) {
                showToast(`Trial expires in ${remainingDays} days. Subscribe to continue using FuelFlow!`, 'info');
            }
            
            return true;
        }

        // Setup mobile navigation functionality
        function setupMobileNavigation() {
            const mobileNavButtons = document.querySelectorAll('.mobile-nav-btn');
            const mobileSections = document.querySelectorAll('.mobile-section');
            
            mobileNavButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const targetSection = e.target.getAttribute('data-mobile-section');
                    
                    // Update button states
                    mobileNavButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.style.background = 'transparent';
                        btn.style.color = 'var(--text-secondary)';
                    });
                    
                    e.target.classList.add('active');
                    e.target.style.background = 'var(--gradient-primary)';
                    e.target.style.color = 'white';
                    
                    // Show/hide sections
                    mobileSections.forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    document.getElementById(`mobile${targetSection.charAt(0).toUpperCase() + targetSection.slice(1)}Section`).classList.remove('hidden');
                    
                    // Update subscription status when settings is opened
                    if (targetSection === 'settings') {
                        updateMobileSubscriptionStatus();
                    }
                });
            });
            
            // Setup mobile search functionality
            document.getElementById('mobileSearchBtn').addEventListener('click', () => {
                const zipCode = document.getElementById('mobileLocationInput').value.trim();
                if (zipCode) {
                    // Sync with desktop search
                    document.getElementById('priceLocationInput').value = zipCode;
                    searchPrices();
                }
            });
            
            // Setup mobile order functionality
            document.getElementById('mobileOrderBtn').addEventListener('click', () => {
                if (!requireSubscription('Place order')) return;
                
                const location = document.getElementById('mobileLocationOrder').value.trim();
                const vehicleType = document.getElementById('mobileVehicleType').value;
                const fuelInstructions = document.getElementById('mobileFuelInstructions').value.trim();
                
                if (!location || !vehicleType || !fuelInstructions) {
                    showToast('Please fill in all required fields', 'error');
                    return;
                }
                
                showToast('Order placed successfully from mobile!', 'success');
            });
            
            // Setup mobile location save
            document.getElementById('mobileSaveLocation').addEventListener('click', () => {
                const zipCode = document.getElementById('mobileDefaultZip').value.trim();
                if (!zipCode.match(/^33[0-9]{3}$/)) {
                    showToast('Please enter a valid Miami ZIP code (33xxx)', 'error');
                    return;
                }
                
                localStorage.setItem('userZipCode', zipCode);
                document.getElementById('userZipCode').value = zipCode;
                document.getElementById('locationInput').value = zipCode;
                document.getElementById('mobileLocationOrder').value = zipCode;
                
                showToast('Location saved!', 'success');
            });
            
            // Setup mobile theme toggle
            const mobileThemeToggle = document.getElementById('mobileThemeToggle');
            const mobileThemeToggleThumb = document.getElementById('mobileThemeToggleThumb');
            
            mobileThemeToggle.addEventListener('click', () => {
                // Sync with desktop theme toggle
                document.getElementById('themeToggle').click();
            });
        }

        // Update mobile subscription status
        function updateMobileSubscriptionStatus() {
            const statusDiv = document.getElementById('mobileSubscriptionStatus');
            const isActive = checkSubscriptionStatus();
            const isTrialUser = localStorage.getItem('isTrialUser') === 'true';
            const remainingDays = getRemainingTrialDays();
            
            if (!isActive) {
                statusDiv.innerHTML = '‚ö† No Subscription';
                statusDiv.style.color = 'var(--error)';
            } else if (isTrialUser && remainingDays !== null) {
                statusDiv.innerHTML = `üéâ Trial: ${remainingDays} days left`;
                statusDiv.style.color = 'var(--success)';
            } else {
                statusDiv.innerHTML = '‚úì Active Subscription';
                statusDiv.style.color = 'var(--success)';
            }
        }

        // Universal Gas Station Finder - Works with ANY US ZIP Code
        async function findGasStationsForZipCode(zipCode) {
            try {
                console.log(`üîç Searching for gas stations in ZIP code: ${zipCode}`);
                
                // Step 1: Convert ZIP code to coordinates
                const coordinates = await getCoordinatesFromZipCode(zipCode);
                if (!coordinates) {
                    throw new Error('Could not find coordinates for ZIP code');
                }
                
                console.log(`üìç Found coordinates: ${coordinates.lat}, ${coordinates.lng} for ${zipCode}`);
                
                // Step 2: Find gas stations near coordinates
                const gasStations = await findGasStationsNearCoordinates(coordinates.lat, coordinates.lng, zipCode);
                
                console.log(`‚õΩ Found ${gasStations.length} gas stations near ${zipCode}`);
                return gasStations;
                
            } catch (error) {
                console.error('Error finding gas stations:', error);
                return [];
            }
        }

        // Convert ZIP code to GPS coordinates
        async function getCoordinatesFromZipCode(zipCode) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Comprehensive Miami-Dade County ZIP code database
            const miamiZipCodeDatabase = {
                // Miami-Dade County ZIP codes with precise coordinates
                '33101': { lat: 25.7617, lng: -80.1918, city: 'Miami Beach, FL' },
                '33102': { lat: 25.7753, lng: -80.1947, city: 'Miami Beach, FL' },
                '33109': { lat: 25.8756, lng: -80.1253, city: 'Bay Harbor Islands, FL' },
                '33114': { lat: 25.8443, lng: -80.1430, city: 'Surfside, FL' },
                '33119': { lat: 25.8398, lng: -80.1253, city: 'Bal Harbour, FL' },
                '33122': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33125': { lat: 25.7676, lng: -80.2429, city: 'Miami, FL' },
                '33126': { lat: 25.7843, lng: -80.2382, city: 'Miami, FL' },
                '33127': { lat: 25.7825, lng: -80.2178, city: 'Miami, FL' },
                '33128': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33129': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33130': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33131': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33132': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33133': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33134': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33135': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33136': { lat: 25.7814, lng: -80.1945, city: 'Miami, FL' },
                '33137': { lat: 25.8398, lng: -80.1253, city: 'Miami Beach, FL' },
                '33138': { lat: 25.8756, lng: -80.1253, city: 'Miami Beach, FL' },
                '33139': { lat: 25.7907, lng: -80.1300, city: 'Miami Beach, FL' },
                '33140': { lat: 25.7907, lng: -80.1300, city: 'Miami Beach, FL' },
                '33141': { lat: 25.8756, lng: -80.1253, city: 'Miami Beach, FL' },
                '33142': { lat: 25.8138, lng: -80.2310, city: 'Miami, FL' },
                '33143': { lat: 25.6760, lng: -80.3025, city: 'Coral Gables, FL' },
                '33144': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33145': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33146': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33147': { lat: 25.8426, lng: -80.2130, city: 'Miami, FL' },
                '33149': { lat: 25.7907, lng: -80.1300, city: 'Miami Beach, FL' },
                '33150': { lat: 25.8756, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33154': { lat: 25.8756, lng: -80.1253, city: 'Bal Harbour, FL' },
                '33155': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33156': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33157': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33158': { lat: 25.9398, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33160': { lat: 25.9398, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33161': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33162': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33163': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33164': { lat: 25.9398, lng: -80.1253, city: 'North Miami Beach, FL' },
                '33165': { lat: 25.7334, lng: -80.2456, city: 'Miami, FL' },
                '33166': { lat: 25.8138, lng: -80.2310, city: 'Miami Lakes, FL' },
                '33167': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33168': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33169': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33170': { lat: 25.9334, lng: -80.2456, city: 'Miami Gardens, FL' },
                '33172': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33173': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33174': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33175': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33176': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33177': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33178': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33179': { lat: 25.9398, lng: -80.1253, city: 'Sunny Isles Beach, FL' },
                '33180': { lat: 25.9398, lng: -80.1253, city: 'Aventura, FL' },
                '33181': { lat: 25.9398, lng: -80.1253, city: 'Aventura, FL' },
                '33182': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33183': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33184': { lat: 25.7923, lng: -80.3115, city: 'Miami, FL' },
                '33185': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33186': { lat: 25.6716, lng: -80.3014, city: 'Miami, FL' },
                '33187': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33188': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33189': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33190': { lat: 25.6100, lng: -80.3566, city: 'Miami, FL' },
                '33193': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33194': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33195': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33196': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33197': { lat: 25.5516, lng: -80.3566, city: 'Miami, FL' },
                '33199': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33231': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33233': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33234': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33238': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33239': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33242': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33243': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33245': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33247': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33283': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                '33296': { lat: 25.7617, lng: -80.1918, city: 'Miami, FL' },
                // Homestead and South Miami-Dade
                '33030': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33031': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33032': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33033': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33034': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                '33035': { lat: 25.4687, lng: -80.4776, city: 'Homestead, FL' },
                // Coral Gables
                '33124': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                '33134': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                '33146': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                '33156': { lat: 25.7334, lng: -80.2456, city: 'Coral Gables, FL' },
                // Hialeah
                '33010': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33011': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33012': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33013': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33014': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33015': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33016': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33017': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                '33018': { lat: 25.8576, lng: -80.2781, city: 'Hialeah, FL' },
                // Key Biscayne
                '33149': { lat: 25.6919, lng: -80.1619, city: 'Key Biscayne, FL' },
                // North Miami
                '33161': { lat: 25.8901, lng: -80.1868, city: 'North Miami, FL' },
                '33162': { lat: 25.8901, lng: -80.1868, city: 'North Miami, FL' },
                '33181': { lat: 25.8901, lng: -80.1868, city: 'North Miami, FL' },
            };
            
            // Check if ZIP code is in Miami-Dade County
            if (miamiZipCodeDatabase[zipCode]) {
                return miamiZipCodeDatabase[zipCode];
            }
            
            // If ZIP code is not in Miami-Dade County, show error
            const firstTwoDigits = parseInt(zipCode.substring(0, 2));
            if (firstTwoDigits !== 33) {
                throw new Error('FuelFlow is currently only available in Miami-Dade County, FL. Please enter a Miami ZIP code (33xxx).');
            }
            
            // For unknown Miami ZIP codes, generate realistic coordinates in Miami area
            return generateMiamiCoordinatesFromZipPattern(zipCode);
        }

        // Generate realistic coordinates for unknown Miami ZIP codes
        function generateMiamiCoordinatesFromZipPattern(zipCode) {
            // Miami-Dade County boundaries
            const miamiLatMin = 25.4500;  // South (Homestead area)
            const miamiLatMax = 25.9500;  // North (Aventura/North Miami Beach)
            const miamiLngMin = -80.5000; // West
            const miamiLngMax = -80.1200; // East (coastline)
            
            // Generate coordinates based on ZIP code pattern within Miami bounds
            const zipSeed = zipCode.split('').reduce((sum, digit) => sum + parseInt(digit), 0);
            const pseudoRandom1 = (zipSeed * 0.1) % 1;
            const pseudoRandom2 = (zipSeed * 0.13) % 1;
            
            const lat = miamiLatMin + pseudoRandom1 * (miamiLatMax - miamiLatMin);
            const lng = miamiLngMin + pseudoRandom2 * (miamiLngMax - miamiLngMin);
            
            return {
                lat: lat,
                lng: lng,
                city: `${zipCode}, Miami-Dade County, FL`
            };
        }

        // Find gas stations near coordinates
        async function findGasStationsNearCoordinates(lat, lng, zipCode) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1200));
            
            // Generate realistic gas stations based on location
            const commonChains = ['Shell', 'BP', 'Exxon', 'Chevron', 'Mobil', 'Sunoco', 'Marathon', 'Speedway', 'Circle K', 'Wawa'];
            const icons = ['üõ°Ô∏è', 'üü¢', 'üî¥', '‚ö°', 'üîµ', '‚òÄÔ∏è', 'üèÉ', '‚ö°', 'üü†', 'üü£'];
            
            const stations = [];
            const numStations = 4; // Always return exactly 4 stations
            
            // Base gas price varies by region (roughly based on US gas price patterns)
            const regionalPriceMultiplier = getRegionalPriceMultiplier(lat, lng);
            const basePrice = 3.75 * regionalPriceMultiplier;
            
            for (let i = 0; i < numStations; i++) {
                const chainIndex = Math.floor(Math.random() * commonChains.length);
                const chain = commonChains[chainIndex];
                const icon = icons[chainIndex];
                
                // Generate realistic distances (0.1 to 2.5 miles)
                const distance = (0.1 + Math.random() * 2.4).toFixed(1);
                
                // Generate realistic street names
                const streets = generateNearbyStreets(lat, lng);
                const street = streets[i % streets.length];
                
                // Price variation by chain and location
                const priceVariation = (Math.random() - 0.5) * 0.3; // ¬±15 cents
                const gasPrice = basePrice + priceVariation;
                
                // Rating between 4.0 and 4.9
                const rating = (4.0 + Math.random() * 0.9).toFixed(1);
                
                // Features
                const allFeatures = ['24/7 available', 'Car wash', 'Convenience store', 'ATM', 'Quick service', 'Premium quality', 'Loyalty rewards', 'Full service'];
                const features = allFeatures.sort(() => 0.5 - Math.random()).slice(0, 2);
                
                stations.push({
                    name: chain,
                    icon: icon,
                    distance: `${distance} mi`,
                    location: street,
                    rating: parseFloat(rating),
                    gasPrice: parseFloat(gasPrice.toFixed(2)),
                    features: features
                });
            }
            
            // Sort by distance
            stations.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
            
            return stations;
        }

        // Get regional price multiplier based on coordinates
        function getRegionalPriceMultiplier(lat, lng) {
            // California (high prices)
            if (lng < -115 && lat > 32 && lat < 42) {
                return 1.25 + Math.random() * 0.15;
            }
            // Northeast (high prices)
            if (lng > -80 && lat > 40) {
                return 1.15 + Math.random() * 0.1;
            }
            // Texas/Gulf Coast (low prices)
            if (lng > -106 && lng < -93 && lat > 25 && lat < 37) {
                return 0.85 + Math.random() * 0.1;
            }
            // Midwest (moderate prices)
            if (lng > -100 && lng < -80 && lat > 35 && lat < 45) {
                return 0.95 + Math.random() * 0.1;
            }
            // Default
            return 1.0 + Math.random() * 0.1;
        }

        // Generate realistic Miami street names based on location
        function generateNearbyStreets(lat, lng) {
            const generalMiamiStreets = [
                // Major Miami mainland streets (NOT Miami Beach)
                'Biscayne Blvd', 'Coral Way', 'Flagler St', 'Calle Ocho', 'Bird Rd',
                'Kendall Dr', 'Sunset Dr', 'Miller Dr', 'Palmetto Expy', 'US Highway 1',
                'NW 7th St', 'SW 8th St', 'NE 2nd Ave', 'SW 1st St',
                'NW 36th St', 'SW 88th St', 'NW 103rd St', 'SW 152nd St'
            ];
            
            // Area-specific streets based on coordinates
            const areaSpecificStreets = [];
            
            // Miami Beach area (higher longitude, closer to coast) - ONLY for beach areas
            if (lng > -80.2) {
                areaSpecificStreets.push('Collins Ave', 'Ocean Drive', 'Washington Ave', 'Lincoln Rd', 'Alton Rd', 'Harding Ave');
                return [...areaSpecificStreets].sort(() => 0.5 - Math.random()).slice(0, 8);
            }
            
            // Downtown Miami area
            if (lat > 25.7 && lat < 25.8 && lng > -80.2 && lng < -80.1) {
                areaSpecificStreets.push('Biscayne Blvd', 'Flagler St', 'NE 2nd Ave', 'SE 1st St', 'NW 1st Ave', 'SE 2nd Ave');
            }
            
            // Coral Gables area (33143 and similar)
            if (lat > 25.65 && lat < 25.75 && lng < -80.25) {
                areaSpecificStreets.push('Miracle Mile', 'Coral Way', 'Le Jeune Rd', 'Douglas Rd', 'Ponce de Leon Blvd', 'Alhambra Circle');
            }
            
            // South Miami/Kendall area
            if (lat < 25.7 && lng < -80.25) {
                areaSpecificStreets.push('Kendall Dr', 'Sunset Dr', 'Miller Dr', 'Red Rd', 'Ludlam Rd', 'SW 88th St', 'SW 137th Ave');
            }
            
            // Homestead area
            if (lat < 25.6) {
                areaSpecificStreets.push('Homestead Ave', 'Krome Ave', 'SW 152nd St', 'SW 136th St', 'Campbell Dr');
            }
            
            // North Miami area
            if (lat > 25.85) {
                areaSpecificStreets.push('Aventura Blvd', 'NW 199th St', 'Biscayne Blvd', 'NE 163rd St', 'Bay Harbor Dr', 'Kane Concourse');
            }
            
            // Combine general Miami streets with area-specific ones
            const allStreets = [...generalMiamiStreets, ...areaSpecificStreets];
            return allStreets.sort(() => 0.5 - Math.random()).slice(0, 8);
        }

        // Enhanced search function
        async function searchPrices() {
            const location = document.getElementById('priceLocationInput').value.trim();
            const searchBtn = document.getElementById('searchBtnText');
            
            if (!location) {
                showToast('Please enter a ZIP code', 'error');
                return;
            }

            // Extract ZIP code from input
            const zipCode = extractZipCode(location);
            if (!zipCode) {
                showToast('Please enter a valid US ZIP code', 'error');
                return;
            }

            searchBtn.innerHTML = '<div class="loading"></div> Searching...';
            
            // Show loading state
            const container = document.getElementById('gasStationsList');
            container.innerHTML = `
                <div class="loading-stations">
                    <div class="loading"></div>
                    <div>Finding gas stations near ${zipCode}...</div>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem;">This may take a few seconds</div>
                </div>
            `;
            
            try {
                const stations = await findGasStationsForZipCode(zipCode);
                
                if (stations.length > 0) {
                    currentGasStations = stations;
                    lastSearchLocation = location;
                    
                    // Update all views
                    populateGasStations();
                    populateAdminGasStations();
                    updateMobileStations();
                    
                    showToast(`‚úÖ Found ${stations.length} gas stations near ${zipCode}`, 'success');
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚õΩ</div>
                            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">No gas stations found</div>
                            <div>Try a different ZIP code</div>
                        </div>
                    `;
                    showToast('‚ùå No gas stations found in this area', 'error');
                }
            } catch (error) {
                console.error('Search error:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--error);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Search failed</div>
                        <div>Please try again</div>
                    </div>
                `;
                showToast('Error searching for gas stations. Please try again.', 'error');
            } finally {
                searchBtn.textContent = 'üîç Search Gas Stations';
            }
        }

        // Plan selection helper
        function selectPlan(planType) {
            const radioBtn = document.getElementById(planType + 'Plan');
            if (radioBtn) radioBtn.checked = true;
            
            // Update visual selection
            document.querySelectorAll('[onclick*="selectPlan"]').forEach(div => {
                div.style.border = '1px solid var(--border-light)';
                div.style.backgroundColor = 'var(--surface)';
            });
            
            event.target.closest('div').style.border = '2px solid var(--primary)';
            event.target.closest('div').style.backgroundColor = 'rgba(0, 122, 255, 0.05)';
        }
        
        // Landing page interactions
        function setupLandingPageInteractions() {
            
            // Savings calculator
            const savingsZipInput = document.getElementById('savingsZipInput');
            const savingsResults = document.getElementById('savingsResults');
            
            savingsZipInput.addEventListener('input', async (e) => {
                const zipCode = e.target.value.trim();
                if (zipCode.length === 5 && zipCode.match(/^33[0-9]{3}$/)) {
                    savingsResults.innerHTML = `
                        <div class="savings-animation">
                            <div class="loading"></div>
                            <div>Calculating savings...</div>
                        </div>
                    `;
                    
                    // Simulate calculation
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    const monthlySavings = 45 + Math.floor(Math.random() * 30);
                    const yearlySavings = monthlySavings * 12;
                    const convenience = ['2-hour delivery window', 'Never run out of gas', 'No gas station visits'];
                    
                    savingsResults.innerHTML = `
                        <div class="savings-breakdown">
                            <div class="savings-highlight">
                                <div class="savings-amount">$${monthlySavings}/month</div>
                                <div class="savings-yearly">$${yearlySavings}/year saved</div>
                            </div>
                            <div class="convenience-benefits">
                                ${convenience.map(benefit => `<div class="benefit-item">‚úì ${benefit}</div>`).join('')}
                            </div>
                        </div>
                    `;
                } else if (zipCode.length === 5 && !zipCode.match(/^33[0-9]{3}$/)) {
                    savingsResults.innerHTML = `
                        <div class="savings-error">
                            <div class="error-icon">‚ö†Ô∏è</div>
                            <div>FuelFlow is currently only available in Miami-Dade County, FL</div>
                        </div>
                    `;
                } else {
                    savingsResults.innerHTML = '';
                }
            });
        }
        
        // Mobile search function
        async function searchMobilePrices() {
            const location = document.getElementById('mobileLocationInput').value.trim();
            const searchBtn = document.getElementById('mobileSearchBtnText');
            
            if (!location) {
                showToast('Please enter a ZIP code', 'error');
                return;
            }

            const zipCode = extractZipCode(location);
            if (!zipCode) {
                showToast('Please enter a valid US ZIP code', 'error');
                return;
            }

            searchBtn.innerHTML = '<div class="loading"></div> Searching...';
            
            try {
                const stations = await findGasStationsForZipCode(zipCode);
                
                if (stations.length > 0) {
                    currentGasStations = stations;
                    lastSearchLocation = location;
                    
                    updateMobileStations();
                    populateGasStations();
                    populateAdminGasStations();
                    
                    showToast(`üì± Found ${stations.length} stations near ${zipCode}`, 'success');
                } else {
                    showToast('‚ùå No gas stations found', 'error');
                }
            } catch (error) {
                showToast('Error searching for gas stations', 'error');
            } finally {
                searchBtn.textContent = 'Find Gas Prices';
            }
        }

        // Extract ZIP code from various input formats
        function extractZipCode(input) {
            // Remove all non-digit characters and get first 5 digits
            const digits = input.replace(/\D/g, '');
            if (digits.length >= 5) {
                return digits.substring(0, 5);
            }
            return null;
        }

        // Quick test function for demo buttons
        function testZipCode(zipCode) {
            document.getElementById('priceLocationInput').value = zipCode;
            searchPrices();
        }

        // Clear search and reset to default
        function clearSearch() {
            currentGasStations = [];
            lastSearchLocation = '';
            
            document.getElementById('priceLocationInput').value = '';
            document.getElementById('mobileLocationInput').value = '';
            
            loadDefaultGasStations();
            showToast('üßπ Search cleared - showing default Miami Beach stations', 'info');
        }

        // Load default gas stations (Miami Beach)
        function loadDefaultGasStations() {
            const defaultStations = [
                { name: 'Shell', icon: 'üõ°Ô∏è', distance: '0.5 mi', location: 'Ocean Drive', rating: 4.7, gasPrice: 4.04, features: ['Beach location', '24/7'] },
                { name: 'BP', icon: 'üü¢', distance: '0.8 mi', location: 'Collins Ave', rating: 4.4, gasPrice: 3.98, features: ['Tourist area', 'Quick'] },
                { name: 'Chevron', icon: '‚ö°', distance: '1.1 mi', location: 'Washington Ave', rating: 4.5, gasPrice: 4.09, features: ['South Beach', 'Premium'] },
                { name: 'Mobil', icon: 'üî¥', distance: '1.3 mi', location: 'Alton Rd', rating: 4.2, gasPrice: 3.95, features: ['Full service', 'Car wash'] }
            ];
            
            currentGasStations = defaultStations;
            populateGasStations();
            populateAdminGasStations();
            updateMobileStations();
        }

        // Populate gas stations list
        function populateGasStations() {
            const container = document.getElementById('gasStationsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (currentGasStations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Search for gas stations</div>
                        <div>Enter any US ZIP code above to find nearby gas stations</div>
                    </div>
                `;
                return;
            }
            
            currentGasStations.forEach((station, index) => {
                const ourPrice = currentPrices.premium;
                const savings = (station.gasPrice - ourPrice);
                const savingsPercent = ((savings / station.gasPrice) * 100);
                
                const stationElement = document.createElement('div');
                stationElement.className = 'gas-station';
                stationElement.innerHTML = `
                    <div class="station-info">
                        <div class="station-name">${station.icon} ${station.name}</div>
                        <div class="station-details">üìç ${station.distance} ‚Ä¢ ${station.location}</div>
                        <div class="station-rating">
                            <span>‚≠ê ${station.rating}</span>
                            <span>‚Ä¢</span>
                            <span>${station.features.join(' ‚Ä¢ ')}</span>
                        </div>
                    </div>
                    <div class="price-comparison">
                        <div class="price-row">
                            <span class="price-label">Gas Station:</span>
                            <span class="price gas-price">$${station.gasPrice.toFixed(2)}</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">FuelFlow:</span>
                            <span class="price our-price">$${ourPrice.toFixed(2)}</span>
                        </div>
                        <div class="savings">Save $${savings.toFixed(2)} (${savingsPercent.toFixed(0)}%)</div>
                    </div>
                `;
                
                stationElement.addEventListener('click', () => {
                    document.querySelectorAll('.gas-station').forEach(s => s.classList.remove('selected'));
                    stationElement.classList.add('selected');
                    showToast(`Selected ${station.name} station`, 'info');
                });
                
                container.appendChild(stationElement);
            });
        }

        // Populate admin gas stations
        function populateAdminGasStations() {
            const container = document.getElementById('adminGasStationsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (currentGasStations.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">No gas stations loaded. Search for a location first.</div>';
                return;
            }
            
            currentGasStations.forEach((station) => {
                const ourPrice = currentPrices.premium;
                const margin = (station.gasPrice - ourPrice);
                
                const stationElement = document.createElement('div');
                stationElement.className = 'gas-station';
                stationElement.innerHTML = `
                    <div class="station-info">
                        <div class="station-name">${station.icon} ${station.name}</div>
                        <div class="station-details">üìç ${station.distance} ‚Ä¢ ${station.location}</div>
                        <div class="station-rating">‚≠ê ${station.rating} ‚Ä¢ ${station.features.join(' ‚Ä¢ ')}</div>
                    </div>
                    <div class="price-comparison">
                        <div class="price-row">
                            <span class="price-label">Their Price:</span>
                            <span class="price gas-price">$${station.gasPrice.toFixed(2)}</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Our Price:</span>
                            <span class="price our-price">$${ourPrice.toFixed(2)}</span>
                        </div>
                        <div class="savings">Margin: $${margin.toFixed(2)}</div>
                    </div>
                `;
                
                container.appendChild(stationElement);
            });
        }

        // Update mobile stations
        function updateMobileStations() {
            const container = document.getElementById('mobileStationsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (currentGasStations.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--text-secondary); font-size: 0.9rem;">Search for gas stations above</div>';
                return;
            }
            
            // Show first 3 stations in mobile view
            currentGasStations.slice(0, 3).forEach((station, index) => {
                const ourPrice = currentPrices.premium;
                const savings = (station.gasPrice - ourPrice);
                
                const stationElement = document.createElement('div');
                stationElement.style.cssText = `
                    background: var(--glass); 
                    border: 1px solid ${index === 0 ? 'var(--accent)' : 'var(--glass-border)'}; 
                    border-radius: 12px; 
                    padding: 1rem; 
                    margin-bottom: 0.8rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;
                
                stationElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.3rem;">${station.icon} ${station.name}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${station.distance} ‚Ä¢ ${station.location}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: var(--error); font-weight: 600;">$${station.gasPrice.toFixed(2)}</div>
                            <div style="color: var(--success); font-size: 0.8rem;">Save $${savings.toFixed(2)}</div>
                        </div>
                    </div>
                `;
                
                stationElement.addEventListener('click', () => {
                    document.querySelectorAll('#mobileStationsContainer > div').forEach(s => s.style.borderColor = 'var(--glass-border)');
                    stationElement.style.borderColor = 'var(--accent)';
                });
                
                container.appendChild(stationElement);
            });
        }

        // Other functions (login, navigation, etc.)
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;
                    switchSection(section);
                });
            });
        }

        function switchSection(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            activeSection = section;
        }

        function setupPaymentMethods() {
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', () => {
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.style.borderColor = 'var(--glass-border)';
                        m.classList.remove('selected');
                    });
                    method.style.borderColor = 'var(--accent)';
                    method.classList.add('selected');
                    selectedPayment = method.dataset.payment;
                    showToast(`Selected ${method.querySelector('div:last-child').textContent}`, 'info');
                });
            });
        }

        function updatePricing() {
            const fuelType = document.getElementById('fuelTypeSelect')?.value || 'premium';
            const amount = parseFloat(document.getElementById('amountSelect')?.value || 15);
            
            const fuelPrice = currentPrices[fuelType];
            const fuelCost = fuelPrice * amount;
            const deliveryFee = currentPrices.deliveryFee;
            const total = fuelCost + deliveryFee;
            
            const gasStationPrice = fuelPrice * 1.06;
            const savings = (gasStationPrice - fuelPrice) * amount;

            // Update displays
            if (document.getElementById('gallonAmount')) document.getElementById('gallonAmount').textContent = amount;
            if (document.getElementById('fuelPriceDisplay')) document.getElementById('fuelPriceDisplay').textContent = fuelPrice.toFixed(2);
            if (document.getElementById('fuelCostDisplay')) document.getElementById('fuelCostDisplay').textContent = `$${fuelCost.toFixed(2)}`;
            if (document.getElementById('deliveryFeeDisplay')) document.getElementById('deliveryFeeDisplay').textContent = `$${deliveryFee.toFixed(2)}`;
            if (document.getElementById('savingsDisplay')) document.getElementById('savingsDisplay').textContent = `$${savings.toFixed(2)}`;
            if (document.getElementById('totalCostDisplay')) document.getElementById('totalCostDisplay').textContent = `$${total.toFixed(2)}`;
            
            // Update mobile displays
            if (document.getElementById('mobileTotalDisplay')) document.getElementById('mobileTotalDisplay').textContent = total.toFixed(2);
            if (document.getElementById('mobileSavingsDisplay')) document.getElementById('mobileSavingsDisplay').textContent = savings.toFixed(2);
            
            // Update price selectors
            document.querySelectorAll('.mobile-our-price').forEach(el => {
                el.textContent = currentPrices.premium.toFixed(2);
            });
        }

        function updateAdminPrices() {
            const premium = parseFloat(document.getElementById('premiumPriceInput').value);
            const regular = parseFloat(document.getElementById('regularPriceInput').value);
            const diesel = parseFloat(document.getElementById('dieselPriceInput').value);
            const deliveryFee = parseFloat(document.getElementById('deliveryFeeInput').value);

            if (isNaN(premium) || isNaN(regular) || isNaN(diesel) || isNaN(deliveryFee)) {
                showToast('Please enter valid prices', 'error');
                return;
            }

            currentPrices = { premium, regular, diesel, deliveryFee };
            
            updatePricing();
            populateGasStations();
            populateAdminGasStations();
            updateMobileStations();
            
            showToast('Prices updated successfully! Changes reflected across all screens.', 'success');
        }

        function saveAdminPrices() {
            showToast('Prices saved successfully! üíæ', 'success');
        }

        // Login functions
        // Screen management functions
        function showLandingPage() {
            document.getElementById('landingScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('signupScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('active');
        }
        
        function showScreen(screenName) {
            // Hide all screens
            document.getElementById('landingScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('signupScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('active');
            
            // Show target screen
            if (screenName === 'landing') {
                document.getElementById('landingScreen').classList.remove('hidden');
            } else if (screenName === 'login') {
                document.getElementById('loginScreen').classList.remove('hidden');
            } else if (screenName === 'signup') {
                document.getElementById('signupScreen').classList.remove('hidden');
            } else if (screenName === 'app') {
                document.getElementById('appContainer').classList.add('active');
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email && password) {
                showToast('Signing in...', 'info');
                
                // For demo purposes, simulate login (in real app, use Firebase Auth)
                setTimeout(async () => {
                    try {
                        // Try to find user in database
                        const customersSnapshot = await db.collection('customers')
                            .where('email', '==', email)
                            .limit(1)
                            .get();
                        
                        if (!customersSnapshot.empty) {
                            const customerDoc = customersSnapshot.docs[0];
                            currentUser = { id: customerDoc.id, ...customerDoc.data() };
                            
                            // Update last active
                            await db.collection('customers').doc(customerDoc.id).update({
                                lastActive: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            
                            console.log('User found in database:', currentUser);
                        } else {
                            // Create new user for demo
                            currentUser = { 
                                email, 
                                fullName: email.split('@')[0],
                                accountType: email.includes('admin') ? 'admin' : 'customer'
                            };
                        }
                        
                        isAdmin = currentUser.accountType === 'admin';
                        
                        // Save to localStorage
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        showApp();
                        showToast(`Welcome back, ${currentUser.fullName || email}!`, 'success');
                        
                    } catch (error) {
                        console.error('Login error:', error);
                        
                        // Fallback login
                        currentUser = { email, type: email.includes('admin') ? 'admin' : 'customer' };
                        isAdmin = currentUser.type === 'admin';
                        showApp();
                        showToast('Welcome back!', 'success');
                    }
                }, 1000);
            } else {
                showToast('Please enter email and password', 'error');
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const zipCode = document.getElementById('zipCode').value;
            const subscriptionPlan = document.querySelector('input[name="subscription"]:checked')?.value || 'trial';
            
            // Validate Miami ZIP code
            if (!zipCode.match(/^33[0-9]{3}$/)) {
                showToast('Please enter a valid Miami ZIP code (33xxx)', 'error');
                return;
            }
            
            if (fullName && email && password && zipCode) {
                // Show processing message
                showToast('Creating your account...', 'info');
                
                // Save to Firebase
                const now = new Date();
                const trialEndDate = new Date(now.getTime() + (14 * 24 * 60 * 60 * 1000));
                
                const customerData = {
                    fullName,
                    email,
                    zipCode,
                    subscriptionPlan,
                    subscriptionActive: true,
                    isTrialUser: subscriptionPlan === 'trial',
                    trialEndDate: subscriptionPlan === 'trial' ? trialEndDate.toISOString() : null,
                    accountType: 'customer'
                };
                
                // Save to Firebase
                saveCustomer(customerData)
                    .then(customerId => {
                        console.log('Customer saved to database with ID:', customerId);
                        
                        // Set current user
                        currentUser = {
                            id: customerId,
                            ...customerData
                        };
                        
                        // Also save to localStorage as backup
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        localStorage.setItem('subscriptionActive', 'true');
                        localStorage.setItem('subscriptionPlan', subscriptionPlan);
                        localStorage.setItem('userZipCode', zipCode);
                        localStorage.setItem('isTrialUser', subscriptionPlan === 'trial');
                        
                        if (subscriptionPlan === 'trial') {
                            localStorage.setItem('trialEndDate', trialEndDate.toISOString());
                        }
                        
                        isAdmin = false;
                        showApp();
                        
                        const welcomeMessage = subscriptionPlan === 'trial' 
                            ? `Welcome ${fullName}! Your 14-day free trial has started.`
                            : `Welcome ${fullName}! Your ${subscriptionPlan} subscription is active.`;
                        
                        showToast(welcomeMessage, 'success');
                    })
                    .catch(error => {
                        console.error('Error saving customer:', error);
                        showToast('Account created locally (database unavailable)', 'info');
                        
                        // Fallback to localStorage
                        currentUser = customerData;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        showApp();
                    });
            } else {
                showToast('Please fill in all fields', 'error');
            }
        }
                    
                    currentUser = { 
                        email, 
                        fullName, 
                        type: 'customer',
                        zipCode,
                        subscriptionPlan,
                        subscriptionActive: true,
                        isTrialUser: subscriptionPlan === 'trial',
                        trialEndDate: subscriptionPlan === 'trial' ? trialEndDate.toISOString() : null
                    };
                    
                    // Save subscription status
                    localStorage.setItem('subscriptionActive', 'true');
                    localStorage.setItem('subscriptionPlan', subscriptionPlan);
                    localStorage.setItem('userZipCode', zipCode);
                    localStorage.setItem('isTrialUser', subscriptionPlan === 'trial');
                    if (subscriptionPlan === 'trial') {
                        localStorage.setItem('trialEndDate', trialEndDate.toISOString());
                    }
                    
                    isAdmin = false;
                    showApp();
                    
                    const welcomeMessage = subscriptionPlan === 'trial' 
                        ? `Welcome to FuelFlow, ${fullName}! Your 14-day free trial has started. Enjoy full access until ${trialEndDate.toLocaleDateString()}.`
                        : `Welcome to FuelFlow, ${fullName}! Your ${subscriptionPlan} subscription is now active.`;
                    
                    showToast(welcomeMessage, 'success');
                }, 2000);
            }
        }

        function loginAsGuest() {
            currentUser = { email: 'guest@fuelflow.com', type: 'guest' };
            isAdmin = false;
            // Clear any previous subscription data
            localStorage.setItem('subscriptionActive', 'false');
            showApp();
            showToast('Welcome! Browsing as guest.', 'info');
        }
        
        function logout() {
            currentUser = null;
            isAdmin = false;
            showScreen('landing');
            showToast('Signed out successfully', 'info');
        }

        function logout() {
            currentUser = null;
            isAdmin = false;
            showLoginScreen();
            showToast('Logged out successfully', 'info');
        }

        function showLoginScreen() {
            showScreen('login');
        }

        function showSignupScreen() {
            showScreen('signup');
        }

        function showApp() {
            showScreen('app');
            
            const welcomeEl = document.getElementById('userWelcome');
            if (currentUser && currentUser.fullName) {
                welcomeEl.textContent = `Welcome back, ${currentUser.fullName}!`;
            } else if (currentUser && currentUser.email) {
                welcomeEl.textContent = `Welcome back, ${currentUser.email.split('@')[0]}!`;
            }
            
            // Load dashboard by default
            showAppSection('dashboard');
            
            updatePricing();
        }

        function handleOrder() {
            // Check subscription status first
            if (!requireSubscription('place order')) {
                return;
            }
            
            const button = event.target;
            const originalText = button.innerHTML;
            const paymentMethod = selectedPayment === 'stripe' ? 'Credit Card' : 'Zelle';
            
            // Validate required fields
            const location = document.getElementById('locationInput').value.trim();
            const vehicleType = document.getElementById('vehicleSelect').value;
            const vehicleDetails = document.getElementById('vehicleDetails').value.trim();
            const fuelTankInstructions = document.getElementById('fuelTankInstructions').value.trim();
            
            if (!location) {
                showToast('Please enter a delivery location', 'error');
                return;
            }
            
            if (!vehicleType) {
                showToast('Please select your vehicle type', 'error');
                return;
            }
            
            if (!vehicleDetails) {
                showToast('Please enter your vehicle details', 'error');
                return;
            }
            
            if (!fuelTankInstructions) {
                showToast('Please provide fuel tank opening instructions', 'error');
                return;
            }
            
            // Check if location is in Miami
            if (!location.match(/33[0-9]{3}/) && !location.toLowerCase().includes('miami')) {
                showToast('Delivery is only available in Miami-Dade County', 'error');
                return;
            }
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Order...';
            button.disabled = true;
            
            // Simulate order processing
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check"></i> Order Placed!';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    const deliveryNotes = document.getElementById('deliveryNotes').value.trim();
                    const contactPreference = document.getElementById('contactPreference').value;
                    
                    showToast(`Order placed successfully! Payment via ${paymentMethod}. You'll be contacted via ${contactPreference.replace('text', 'text message').replace('call', 'phone call').replace('app', 'app notification')}.`, 'success');
                }, 1000);
            }, 2000);
        }

        function showToast(message, type = 'info') {
            // Create iOS-style toast
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%) translateY(-100px);
                background: var(--surface);
                color: var(--text-primary);
                padding: 12px 20px;
                border-radius: 24px;
                font-size: 15px;
                font-weight: 500;
                box-shadow: var(--shadow-medium);
                z-index: 1000;
                border: 1px solid var(--border-light);
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                transition: all 0.3s ease;
                max-width: 300px;
                text-align: center;
            `;
            
            // Set color based on type
            if (type === 'success') {
                toast.style.backgroundColor = 'var(--secondary)';
                toast.style.color = 'white';
            } else if (type === 'error') {
                toast.style.backgroundColor = 'var(--error)';
                toast.style.color = 'white';
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(-50%) translateY(0)';
            }, 100);
            
            // Animate out
            setTimeout(() => {
                toast.style.transform = 'translateX(-50%) translateY(-100px)';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Add missing utility functions
        function setupNavigation() {
            // Navigation setup placeholder
        }
        
        function setupPaymentMethods() {
            // Payment methods setup placeholder  
        }
        
        function setupSettingsPanel() {
            // Settings panel setup placeholder
        }
        
        function setupPhotoUpload() {
            // Photo upload setup placeholder
        }
        
        function setupMobileNavigation() {
            // Mobile navigation setup placeholder
        }
        
        function updatePricing() {
            // Pricing update placeholder
        }
        
        function loadUserSettings() {
            // User settings loader placeholder
        }
        
        function loadDefaultGasStations() {
            // Default gas stations loader placeholder
        }
        
        function setupSubscriptionPlanSelection() {
            // Already implemented above
        }
        
        // App section management
        function showAppSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active state from all tabs
            document.querySelectorAll('.app-tab').forEach(tab => {
                tab.style.background = 'transparent';
                tab.style.color = 'var(--text-secondary)';
            });
            
            // Show target section
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            
            // Set active tab
            const activeTab = document.getElementById(sectionName + 'Tab');
            activeTab.style.background = 'var(--primary)';
            activeTab.style.color = 'white';
            
            // Load data if needed
            if (sectionName === 'customers') {
                loadCustomersData();
            } else if (sectionName === 'orders') {
                loadOrdersData();
            } else if (sectionName === 'dashboard') {
                loadDashboardStats();
            }
        }
        
        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                const analytics = await getAnalytics();
                
                document.getElementById('totalCustomersCount').textContent = analytics.totalCustomers;
                document.getElementById('totalOrdersCount').textContent = analytics.totalOrders;
                
                console.log('Dashboard stats loaded:', analytics);
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                document.getElementById('totalCustomersCount').textContent = '0';
                document.getElementById('totalOrdersCount').textContent = '0';
            }
        }
        
        // Load and display customers data
        async function loadCustomersData() {
            const container = document.getElementById('customersContainer');
            container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">Loading customers...</div>';
            
            try {
                const customers = await getAllCustomers();
                
                if (customers.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">No customers found</div>';
                    return;
                }
                
                let html = '';
                customers.forEach((customer, index) => {
                    const createdDate = customer.createdAt ? new Date(customer.createdAt.toDate()).toLocaleDateString() : 'Unknown';
                    const subscriptionStatus = customer.subscriptionActive ? 
                        (customer.isTrialUser ? 'üÜì Trial' : 'üíé Paid') : '‚ùå Inactive';
                    
                    html += `
                        <div style="padding: 1rem; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.2rem;">${customer.fullName || 'Unknown'}</div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 0.2rem;">${customer.email}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">üìç ${customer.zipCode} ‚Ä¢ Joined: ${createdDate}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 14px; font-weight: 600; margin-bottom: 0.2rem;">${subscriptionStatus}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">${customer.subscriptionPlan || 'trial'}</div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading customers:', error);
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--error);">Error loading customers. Check console for details.</div>';
            }
        }
        
        // Load and display orders data
        async function loadOrdersData() {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">Loading orders...</div>';
            
            try {
                // Get all orders
                const ordersSnapshot = await db.collection('orders').orderBy('createdAt', 'desc').limit(20).get();
                const orders = [];
                
                ordersSnapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                if (orders.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">No orders found</div>';
                    return;
                }
                
                let html = '';
                orders.forEach((order, index) => {
                    const createdDate = order.createdAt ? new Date(order.createdAt.toDate()).toLocaleDateString() : 'Unknown';
                    const statusColor = order.status === 'completed' ? 'var(--secondary)' : 
                                       order.status === 'pending' ? 'var(--warning)' : 'var(--error)';
                    
                    html += `
                        <div style="padding: 1rem; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.2rem;">Order #${order.id.substring(0, 8)}</div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 0.2rem;">${order.customerEmail || 'Unknown customer'}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">üìÖ ${createdDate}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 14px; font-weight: 600; color: ${statusColor}; margin-bottom: 0.2rem; text-transform: capitalize;">${order.status || 'pending'}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">$${order.total ? order.total.toFixed(2) : '0.00'}</div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading orders:', error);
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--error);">Error loading orders. Check console for details.</div>';
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>